var Ne=Object.defineProperty;var ke=(t,r,d)=>r in t?Ne(t,r,{enumerable:!0,configurable:!0,writable:!0,value:d}):t[r]=d;var I=(t,r,d)=>ke(t,typeof r!="symbol"?r+"":r,d);import{j as e,c as we,u as Ce,a as Ie}from"./index-B0Hd79CT.js";import{r as i,u as Le}from"./router-BXhMSvr3.js";import{u as Ae,a as C,b as me}from"./query-DSXC375t.js";import{a as L}from"./attendanceService-DsrQtJBq.js";import{l as ue}from"./leaveService-DGV5edJg.js";import{e as Re}from"./employeeService-Bpvb34j3.js";import{b as Se,c as Ee,W as Me,X as q,R as Te,d as R,z as o,C as A,M as F}from"./ui-BANi3Jhe.js";import{g as _,a as Oe,c as Pe}from"./camera-uGge9r08.js";import{l as ge}from"./locationTrackingService-E8fxCNwq.js";import"./vendor-C8w-UNLI.js";import"./utils-ngrFHoWO.js";class De{constructor(r=3e4){I(this,"intervalId",null);I(this,"attendanceId",null);I(this,"isTracking",!1);I(this,"trackingInterval",3e4);this.trackingInterval=r}async startTracking(r){if(this.isTracking){console.log("Location tracking already active");return}this.attendanceId=r,this.isTracking=!0,console.log("ðŸš€ Starting location tracking for attendance:",r),await this.trackCurrentLocation(),this.intervalId=setInterval(async()=>{this.isTracking&&this.attendanceId&&await this.trackCurrentLocation()},this.trackingInterval)}async stopTracking(){if(!this.isTracking||!this.attendanceId){console.log("No active tracking to stop");return}console.log("ðŸ›‘ Stopping location tracking for attendance:",this.attendanceId),this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null);try{await ge.stopTracking(this.attendanceId),console.log("âœ… Location tracking stopped successfully")}catch(r){console.error("âŒ Error stopping location tracking:",r)}this.isTracking=!1,this.attendanceId=null}async trackCurrentLocation(){if(this.attendanceId)try{const r=await _(),d={attendanceId:this.attendanceId,latitude:r.latitude,longitude:r.longitude,accuracy:r.accuracy,address:r.address};await ge.trackLocation(d),console.log("ðŸ“ Location tracked:",{lat:r.latitude,lng:r.longitude,address:r.address,timestamp:new Date().toISOString()})}catch(r){console.error("âŒ Error tracking location:",r)}}getStatus(){return{isTracking:this.isTracking,attendanceId:this.attendanceId}}setInterval(r){this.trackingInterval=r,this.isTracking&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=setInterval(async()=>{this.isTracking&&this.attendanceId&&await this.trackCurrentLocation()},this.trackingInterval))}}const xe=new De,Fe=()=>{const[t,r]=i.useState(null),[d,b]=i.useState(!1),[n,m]=i.useState(null),[l,x]=i.useState(null),h=async()=>{b(!0),x(null);try{const f=await we();r(f.isHealthy),m(new Date),f.isHealthy||x(f.error)}catch(f){r(!1),x(f.message),m(new Date)}finally{b(!1)}};return i.useEffect(()=>{h()},[]),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Backend Connection"}),e.jsx("button",{onClick:h,disabled:d,className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200 disabled:opacity-50",children:d?"Testing...":"Test Again"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[t===null?e.jsx(Se,{className:"w-5 h-5 text-gray-400"}):t?e.jsx(Ee,{className:"w-5 h-5 text-green-500"}):e.jsx(Me,{className:"w-5 h-5 text-red-500"}),e.jsxs("div",{className:"flex-1",children:[t===null&&e.jsx("p",{className:"text-gray-600",children:"Testing connection..."}),t===!0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 font-medium",children:"âœ… Backend is running"}),n&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Last checked: ",n.toLocaleTimeString()]})]}),t===!1&&e.jsxs("div",{children:[e.jsx("p",{className:"text-red-600 font-medium",children:"âŒ Cannot connect to backend"}),l&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l}),n&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Last checked: ",n.toLocaleTimeString()]})]})]})]}),t===!1&&e.jsxs("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800 mb-2",children:"Troubleshooting:"}),e.jsxs("ul",{className:"text-xs text-red-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Check if the backend server is running"}),e.jsx("li",{children:"â€¢ Verify your internet connection"}),e.jsx("li",{children:"â€¢ Try refreshing the page"}),e.jsx("li",{children:"â€¢ Contact support if the issue persists"})]})]})]})},qe=({isOpen:t,onClose:r,onCapture:d,title:b})=>{const n=i.useRef(null),m=i.useRef(null),l=i.useRef(null),[x,h]=i.useState(!1),[f,M]=i.useState("user");i.useEffect(()=>(t?k():S(),()=>{S()}),[t,f]);const k=async()=>{try{const u={video:{facingMode:f,width:{ideal:1280},height:{ideal:720}},audio:!1},g=await navigator.mediaDevices.getUserMedia(u);l.current=g,n.current&&(n.current.srcObject=g,n.current.play(),h(!0))}catch(u){throw console.error("âŒ Camera access failed:",u),new Error("Camera access denied or not available")}},S=()=>{l.current&&(l.current.getTracks().forEach(u=>u.stop()),l.current=null),h(!1)},U=()=>{if(!n.current||!m.current)return;const u=n.current,g=m.current,E=g.getContext("2d");if(!E)return;g.width=u.videoWidth,g.height=u.videoHeight,E.drawImage(u,0,0,g.width,g.height);const j=g.toDataURL("image/jpeg",.8);S(),d(j),r()},w=()=>{M(u=>u==="user"?"environment":"user")};return t?e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center",children:e.jsxs("div",{className:"relative w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-white text-lg font-semibold",children:b}),e.jsx("button",{onClick:r,className:"text-white hover:text-gray-300 transition-colors",children:e.jsx(q,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden",children:[e.jsx("video",{ref:n,className:"w-full h-64 object-cover",playsInline:!0,muted:!0}),e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("button",{onClick:w,className:"bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-70 transition-all",title:"Switch Camera",children:e.jsx(Te,{className:"w-5 h-5"})})}),e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2",children:e.jsx("button",{onClick:U,disabled:!x,className:"bg-white w-16 h-16 rounded-full flex items-center justify-center shadow-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:e.jsx(R,{className:"w-8 h-8 text-gray-800"})})})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-white text-sm",children:x?"Position yourself in the frame and tap the camera button":"Starting camera..."})}),e.jsx("canvas",{ref:m,className:"hidden"})]})}):null},Xe=()=>{var z,B,G,Q,$,V,K,Y,X,J,Z,ee,te,se,ae,re,le,ne,oe,ie,ce,de,he;const{user:t}=Ce(),r=Le();console.log("ðŸ‘¤ Dashboard user data:",t),console.log("ðŸ”‘ User role:",t==null?void 0:t.role),console.log("ðŸ†” User ID:",t==null?void 0:t.id);const[d,b]=i.useState(!1),[n,m]=i.useState(null),[l,x]=i.useState(null),[h,f]=i.useState(!1),[M,k]=i.useState(!1),[S,U]=i.useState("overview"),w=Ae(),u=()=>{var s,c;return(s=a==null?void 0:a.status)!=null&&s.isCompleted?{type:"completed",message:"ðŸŽ‰ Work day completed successfully!",color:"green",icon:"âœ…"}:(c=a==null?void 0:a.status)!=null&&c.canCheckOut?{type:"checkout",message:"ðŸŒ† Ready for smart check-out",color:"orange",icon:"ðŸ•"}:{type:"checkin",message:"ðŸŒ… Ready for smart check-in",color:"blue",icon:"ðŸš€"}},{data:g,error:E}=C("my-attendance",()=>L.getAttendance({employeeId:t==null?void 0:t.employeeId}),{enabled:!!(t!=null&&t.employeeId),retry:2,retryDelay:1e3,onError:s=>{s.code!=="NETWORK_ERROR"&&console.error("Attendance data fetch error:",s)}}),{data:j,error:be}=C("my-leave-requests",()=>ue.getLeaveRequests({employeeId:t==null?void 0:t.employeeId}),{enabled:!!(t!=null&&t.employeeId),retry:2,retryDelay:1e3,onError:s=>{s.code!=="NETWORK_ERROR"&&console.error("Leave data fetch error:",s)}}),{data:T,error:pe}=C("employee-stats",()=>Re.getEmployeeStats(),{enabled:(t==null?void 0:t.role)==="SUPER_ADMIN"||(t==null?void 0:t.role)==="HR_MANAGER",retry:2,retryDelay:1e3,onError:s=>{s.code!=="NETWORK_ERROR"&&console.error("Employee stats fetch error:",s)}}),{data:O,error:fe}=C("attendance-stats",()=>L.getAttendanceStats(),{enabled:(t==null?void 0:t.role)==="SUPER_ADMIN"||(t==null?void 0:t.role)==="HR_MANAGER",retry:2,retryDelay:1e3,onError:s=>{s.code!=="NETWORK_ERROR"&&console.error("Attendance stats fetch error:",s)}}),{data:P,error:ye}=C("leave-stats",()=>ue.getLeaveStats(),{enabled:(t==null?void 0:t.role)==="SUPER_ADMIN"||(t==null?void 0:t.role)==="HR_MANAGER",retry:2,retryDelay:1e3,onError:s=>{s.code!=="NETWORK_ERROR"&&console.error("Leave stats fetch error:",s)}}),y=me(L.selfCheckIn,{onSuccess:s=>{w.invalidateQueries("my-attendance"),w.invalidateQueries("attendance-status"),s!=null&&s.id&&(xe.startTracking(s.id),console.log("ðŸš€ Location tracking started for attendance:",s.id)),o.success("âœ… Check-in completed successfully! Location tracking started."),b(!1),m(null),x(null)},onError:s=>{var N,p;const c=((p=(N=s.response)==null?void 0:N.data)==null?void 0:p.error)||"Failed to check in";c.includes("already marked")?o.error("You have already checked in today. Please check out first."):c.includes("Already completed attendance")?o.error("Attendance already completed for today"):o.error(c)}}),v=me(L.selfCheckOut,{onSuccess:()=>{w.invalidateQueries("my-attendance"),w.invalidateQueries("attendance-status"),xe.stopTracking(),console.log("ðŸ›‘ Location tracking stopped after check-out"),o.success("âœ… Check-out completed successfully! Your attendance has been recorded with selfie and location."),b(!1),m(null),x(null)},onError:s=>{var N,p;const c=((p=(N=s.response)==null?void 0:N.data)==null?void 0:p.error)||"Failed to check out";c.includes("No active check-in")?o.error("âŒ Please check in first before checking out"):c.includes("Already checked out")?o.error("âŒ You have already checked out today"):c.includes("User ID required")?o.error("âŒ Authentication error. Please login again."):o.error(`âŒ Check-out failed: ${c}`)}});i.useEffect(()=>{if(l&&n&&!y.isLoading&&!v.isLoading){console.log("ðŸ§  Smart system: Both selfie and location ready, auto-submitting...");const s=l.length>1e5?1e3:500,c=setTimeout(()=>{W()},s);return()=>clearTimeout(c)}},[l,n,y.isLoading,v.isLoading]);const{data:a}=C("attendance-status",()=>L.getAttendanceStatus(),{enabled:!!(t!=null&&t.employeeId),refetchInterval:3e4,refetchOnWindowFocus:!0,onSuccess:s=>{console.log("ðŸ“Š Frontend attendance status:",s)}}),D=async()=>{await ve()},ve=async()=>{try{const s=await _();m(s),console.log("ðŸ“ Location captured automatically:",{hasLocation:!!s,locationData:s}),o.success("ðŸ“ Location captured automatically!")}catch(s){console.log("âŒ Location capture failed:",s),o.error(s.message||"Failed to get location");return}k(!0)},je=s=>{x(s),console.log("ðŸ“¸ Selfie captured from live camera:",{hasSelfie:!!s,selfieLength:(s==null?void 0:s.length)||0}),o.success("ðŸ“¸ Selfie captured successfully!"),k(!1),n?o("âœ… Both selfie and location ready! Attendance will be marked automatically.",{icon:"â„¹ï¸"}):o("ðŸ“ Selfie captured! Waiting for location data...",{icon:"â„¹ï¸"})},W=()=>{var N;const s=Oe();console.log("ðŸ” Auto-submit state check:",{hasSelfie:!!l,selfieLength:(l==null?void 0:l.length)||0,hasLocation:!!n,locationData:n,attendanceStatus:a==null?void 0:a.status,user:t,userId:t==null?void 0:t.id,isAuthenticated:Ie.isAuthenticated()});const c=(N=a==null?void 0:a.status)==null?void 0:N.canCheckOut;if(c){if(!l){o.error("âŒ Check-out requires a selfie. Please capture your selfie first.");return}if(!n){o.error("âŒ Check-out requires location. Please allow location access.");return}console.log("âœ… Check-out requirements validated: Selfie + Location captured")}else{if(!l){o.error("âŒ Check-in requires a selfie. Please capture your selfie first.");return}if(!n){o.error("âŒ Check-in requires location. Please allow location access.");return}console.log("âœ… Check-in requirements validated: Selfie + Location captured")}if(c){const p={notes:void 0,checkOutSelfie:l||void 0,checkOutLocation:n||void 0};console.log("ðŸ” Check-out data being sent:",{hasSelfie:!!l,selfieLength:(l==null?void 0:l.length)||0,selfiePreview:(l==null?void 0:l.substring(0,50))+"...",hasLocation:!!n,locationData:n,checkOutData:p,fullPayload:{notes:void 0,checkOutSelfie:l||void 0,checkOutLocation:n||void 0}}),o.loading("ðŸŽ¯ Automatically checking out...",{duration:2e3}),v.mutate(p)}else{const p={isRemote:!1,notes:void 0,checkInSelfie:l||void 0,checkInLocation:n||void 0,deviceInfo:s||void 0,shiftId:null};console.log("ðŸ” Check-in data being sent:",{hasSelfie:!!l,selfieLength:(l==null?void 0:l.length)||0,selfiePreview:(l==null?void 0:l.substring(0,50))+"...",hasLocation:!!n,locationData:n,checkInData:p,fullPayload:{isRemote:!1,notes:void 0,checkInSelfie:l||void 0,checkInLocation:n||void 0,deviceInfo:s||void 0,shiftId:null}}),o.loading("ðŸŽ¯ Automatically checking in...",{duration:2e3}),y.mutate(p)}},H=(t==null?void 0:t.role)==="SUPER_ADMIN"||(t==null?void 0:t.role)==="HR_MANAGER";return e.jsxs("div",{className:"p-6",children:[e.jsx(Fe,{}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ðŸŽ‰ Smart Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"AI-powered workforce management system"})]})}),H?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:(T==null?void 0:T.totalEmployees)||0})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-900",children:"Active Today"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:(O==null?void 0:O.presentCount)||0})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-purple-900",children:"Pending Leaves"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:(P==null?void 0:P.pendingRequests)||0})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"My Attendance"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:((B=(z=g==null?void 0:g.data)==null?void 0:z.attendances)==null?void 0:B.length)||0})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-900",children:"My Leave Requests"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:((Q=(G=j==null?void 0:j.data)==null?void 0:G.leaveRequests)==null?void 0:Q.length)||0})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-purple-900",children:"Pending Leaves"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:((V=($=j==null?void 0:j.data)==null?void 0:$.leaveRequests)==null?void 0:V.filter(s=>s.status==="PENDING").length)||0})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsx("div",{className:"space-y-2",children:H?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r("/attendance"),className:"w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors cursor-pointer",children:"Mark Attendance"}),e.jsx("button",{onClick:()=>r("/employees"),className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded hover:bg-gray-300 transition-colors cursor-pointer",children:"View Employees"}),e.jsx("button",{onClick:()=>r("/leave-requests"),className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded hover:bg-gray-300 transition-colors cursor-pointer",children:"Manage Leave Requests"}),(t==null?void 0:t.role)==="SUPER_ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r("/employees"),className:"w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700 transition-colors cursor-pointer",children:"User & Role Management"}),e.jsx("button",{onClick:()=>r("/shifts"),className:"w-full bg-orange-600 text-white py-2 px-4 rounded hover:bg-orange-700 transition-colors cursor-pointer",children:"Shift Management"}),e.jsx("button",{onClick:()=>r("/settings"),className:"w-full bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 transition-colors cursor-pointer",children:"System Settings"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>b(!0),className:"w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition-colors cursor-pointer",children:"Mark Self Attendance"}),e.jsx("button",{onClick:()=>r("/my-attendance"),className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded hover:bg-gray-300 transition-colors cursor-pointer",children:"View My Attendance"}),e.jsx("button",{onClick:()=>r("/my-leave"),className:"w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors cursor-pointer",children:"Request Leave"}),e.jsx("button",{onClick:()=>r("/profile"),className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded hover:bg-gray-300 transition-colors cursor-pointer",children:"View My Profile"})]})})]}),(t==null?void 0:t.role)==="SUPER_ADMIN"&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Super Admin Features"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"font-semibold text-purple-900 mb-2",children:"User Management"}),e.jsx("p",{className:"text-sm text-purple-700 mb-3",children:"Manage employees and users"}),e.jsx("button",{onClick:()=>r("/employees"),className:"w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700 text-sm transition-colors cursor-pointer",children:"Manage Employees"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[e.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:"Shift Management"}),e.jsx("p",{className:"text-sm text-orange-700 mb-3",children:"Create and manage work shifts"}),e.jsx("button",{onClick:()=>r("/shifts"),className:"w-full bg-orange-600 text-white py-2 px-4 rounded hover:bg-orange-700 text-sm transition-colors cursor-pointer",children:"Manage Shifts"})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"System Settings"}),e.jsx("p",{className:"text-sm text-red-700 mb-3",children:"Configure system-wide settings"}),e.jsx("button",{onClick:()=>r("/settings"),className:"w-full bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 text-sm transition-colors cursor-pointer",children:"System Config"})]}),e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg border border-indigo-200",children:[e.jsx("h3",{className:"font-semibold text-indigo-900 mb-2",children:"Payroll Management"}),e.jsx("p",{className:"text-sm text-indigo-700 mb-3",children:"Manage employee salaries"}),e.jsx("button",{onClick:()=>r("/payroll"),className:"w-full bg-indigo-600 text-white py-2 px-4 rounded hover:bg-indigo-700 text-sm transition-colors cursor-pointer",children:"Manage Payroll"})]}),e.jsxs("div",{className:"bg-teal-50 p-4 rounded-lg border border-teal-200",children:[e.jsx("h3",{className:"font-semibold text-teal-900 mb-2",children:"Attendance Reports"}),e.jsx("p",{className:"text-sm text-teal-700 mb-3",children:"View attendance analytics"}),e.jsx("button",{onClick:()=>r("/attendance"),className:"w-full bg-teal-600 text-white py-2 px-4 rounded hover:bg-teal-700 text-sm transition-colors cursor-pointer",children:"View Attendance"})]}),e.jsxs("div",{className:"bg-pink-50 p-4 rounded-lg border border-pink-200",children:[e.jsx("h3",{className:"font-semibold text-pink-900 mb-2",children:"Leave Management"}),e.jsx("p",{className:"text-sm text-pink-700 mb-3",children:"Manage leave requests"}),e.jsx("button",{onClick:()=>r("/leave"),className:"w-full bg-pink-600 text-white py-2 px-4 rounded hover:bg-pink-700 text-sm transition-colors cursor-pointer",children:"Manage Leaves"})]})]})]}),e.jsxs("div",{className:"mt-8 p-4 bg-green-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-900",children:"System Status"}),e.jsx("p",{className:"text-green-700",children:"âœ… All systems operational"}),(E||be||pe||fe||ye)&&e.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded",children:e.jsx("p",{className:"text-yellow-800 text-sm",children:"âš ï¸ Some data may not be up to date due to network issues. Please refresh the page."})})]})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-lg mx-auto max-h-[95vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b sticky top-0 bg-white z-10",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),"Mark Attendance"]}),e.jsx("button",{onClick:()=>{b(!1),x(null),m(null)},className:"text-gray-400 hover:text-gray-600",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[(()=>{const s=u();return e.jsxs("div",{className:`mb-6 p-4 rounded-lg border-2 ${s.color==="green"?"bg-green-50 border-green-200":s.color==="orange"?"bg-orange-50 border-orange-200":"bg-blue-50 border-blue-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${s.color==="green"?"bg-green-500":s.color==="orange"?"bg-orange-500":"bg-blue-500"}`}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[s.icon," ",s.message]})]}),s.type!=="completed"&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx("p",{className:"text-xs text-gray-600",children:"ðŸ§  Smart system will handle location + selfie automatically"})})]})})(),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(A,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Automatic Data Capture"})]}),e.jsx("p",{className:"text-sm text-blue-700",children:"Date, time, and status will be automatically captured when you take your selfie."})]}),!l&&!n?e.jsxs("div",{className:"p-8 bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 border-2 border-blue-400 rounded-xl shadow-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:`w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg ${(K=a==null?void 0:a.status)!=null&&K.canCheckOut?"bg-orange-600":(Y=a==null?void 0:a.status)!=null&&Y.isCompleted?"bg-green-600":"bg-blue-600"}`,children:e.jsx(R,{className:"w-10 h-10 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:(X=a==null?void 0:a.status)!=null&&X.isCompleted?"âœ… Attendance Completed":(J=a==null?void 0:a.status)!=null&&J.canCheckOut?"ðŸ“¸ Check-Out Selfie":"ðŸ“¸ Check-In Selfie"}),e.jsx("p",{className:"text-base text-gray-700",children:(Z=a==null?void 0:a.status)!=null&&Z.isCompleted?"ðŸŽ‰ You have completed your attendance for today":(ee=a==null?void 0:a.status)!=null&&ee.canCheckOut?"ðŸŒ† Take your check-out selfie":"ðŸŒ… Take your check-in selfie"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:(te=a==null?void 0:a.status)!=null&&te.isCompleted?"Great job! See you tomorrow.":(se=a==null?void 0:a.status)!=null&&se.canCheckOut?"ðŸŒ† One-click smart checkout with selfie & location":"ðŸŒ… One-click smart check-in with selfie & location"})]}),e.jsx("button",{type:"button",onClick:D,disabled:h||((ae=a==null?void 0:a.status)==null?void 0:ae.isCompleted),className:`w-full flex items-center justify-center gap-3 px-8 py-4 text-white text-xl font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed shadow-xl transform transition-all duration-300 hover:scale-105 hover:shadow-2xl ${(re=a==null?void 0:a.status)!=null&&re.isCompleted?"bg-gray-500 cursor-not-allowed":(le=a==null?void 0:a.status)!=null&&le.canCheckOut?"bg-gradient-to-r from-orange-500 via-orange-600 to-orange-700 hover:from-orange-600 hover:via-orange-700 hover:to-orange-800":"bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:from-blue-600 hover:via-blue-700 hover:to-blue-800"}`,children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"}),"Opening Camera..."]}):(ne=a==null?void 0:a.status)!=null&&ne.isCompleted?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-6 h-6",children:"âœ…"}),"Attendance Completed"]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-6 h-6"}),"ðŸ“¸ ",(oe=a==null?void 0:a.status)!=null&&oe.canCheckOut?"Smart Check-Out":"Smart Check-In"]})}),e.jsxs("p",{className:"text-xs text-gray-600 mt-4 text-center bg-white/50 p-3 rounded-lg",children:["â„¹ï¸ ",(ie=a==null?void 0:a.status)!=null&&ie.canCheckOut?"Smart Check-Out: Automatic location + live camera selfie":"Smart Check-In: Automatic location + live camera selfie"]})]}):e.jsxs(e.Fragment,{children:[l&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-lg font-semibold",children:"ðŸ“¸ Attendance Selfie âœ…"}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:l,alt:"Attendance Selfie",className:"w-full h-80 object-cover rounded-xl border-4 border-green-500 shadow-lg"}),e.jsxs("button",{type:"button",onClick:()=>{x(null),m(null)},className:"absolute top-3 right-3 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 flex items-center gap-2 shadow-lg",children:[e.jsx(R,{className:"w-5 h-5"}),"Retake"]})]}),l&&n&&e.jsx("div",{className:"mt-4 p-4 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-lg shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("p",{className:"text-green-800 font-medium",children:"ðŸ§  Smart system ready! Both selfie and location captured"}),e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("button",{type:"button",onClick:W,disabled:y.isLoading||v.isLoading,className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-lg font-bold text-lg hover:from-green-600 hover:to-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 shadow-lg transform transition-all duration-300 hover:scale-105",children:y.isLoading||v.isLoading?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"}),(ce=a==null?void 0:a.status)!=null&&ce.canCheckOut?"Checking Out...":"Checking In..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-6 h-6"}),(de=a==null?void 0:a.status)!=null&&de.canCheckOut?"Complete Check-Out":"Complete Check-In"]})})]})})]}),n&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Your Location âœ…"}),e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-green-600"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium text-green-900",children:n.address||`${n.latitude.toFixed(6)}, ${n.longitude.toFixed(6)}`})})]})})]})]}),l&&n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-800",children:"Time will be automatically captured"})]}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"Current time will be used for check-in/check-out"})]}),e.jsx("div",{className:"p-2 bg-blue-50 border border-blue-200 rounded text-center",children:e.jsx("p",{className:"text-xs text-blue-700",children:"âœ… Selfie, Location, Device & IP captured"})})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{type:"button",onClick:async()=>{try{const s=await Pe();s.hasPermission?o.success("âœ… Camera is working perfectly!"):o.error(s.message)}catch(s){o.error("Camera test failed: "+s.message)}},className:"bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors mr-2",children:"Test Camera"}),e.jsx("button",{type:"button",onClick:D,disabled:h||y.isLoading||v.isLoading,className:"flex-1 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 disabled:opacity-50",children:h?"Capturing...":y.isLoading?"Checking In...":v.isLoading?"Checking Out...":"Take Selfie & Mark Attendance"})]})]})]})}),d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-lg mx-auto max-h-[95vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b sticky top-0 bg-white z-10",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),"Mark Attendance"]}),e.jsx("button",{onClick:()=>b(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(q,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4",children:l?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:l,alt:"Selfie",className:"w-32 h-32 object-cover rounded-lg mx-auto border-2 border-green-500"}),e.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs",children:"âœ“"})]}):e.jsx("div",{className:"w-32 h-32 bg-gray-100 rounded-lg mx-auto flex items-center justify-center border-2 border-dashed border-gray-300",children:e.jsx(R,{className:"w-8 h-8 text-gray-400"})})}),e.jsx("div",{className:"mb-4",children:n?e.jsxs("div",{className:"flex items-center justify-center text-green-600",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"Location captured"})]}):e.jsxs("div",{className:"flex items-center justify-center text-gray-400",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"Getting location..."})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{type:"button",onClick:()=>k(!0),disabled:h,className:"w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 disabled:opacity-50 transition-colors",children:l?"Retake Selfie":"Take Selfie"}),e.jsx("button",{type:"button",onClick:async()=>{try{const s=await _();m(s),o.success("Location updated!")}catch(s){o.error("Failed to get location: "+s.message)}},disabled:h,className:"w-full bg-gray-600 text-white py-2 px-4 rounded hover:bg-gray-700 disabled:opacity-50 transition-colors",children:"Update Location"})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx("button",{type:"button",onClick:D,disabled:h||y.isLoading||v.isLoading,className:"w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 disabled:opacity-50 transition-colors",children:h?"Capturing...":y.isLoading?"Checking In...":v.isLoading?"Checking Out...":"Mark Attendance"})})]})})]})}),e.jsx(qe,{isOpen:M,onClose:()=>k(!1),onCapture:je,title:(he=a==null?void 0:a.status)!=null&&he.canCheckOut?"Check-Out Selfie":"Check-In Selfie"})]})};export{Xe as default};
//# sourceMappingURL=Dashboard-DpEDWpke.js.map
