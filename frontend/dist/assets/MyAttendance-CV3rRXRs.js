import{u as $,j as e}from"./index-j-xEUIA1.js";import{r as n}from"./router-BXhMSvr3.js";import{u as q,a as P,b as Q}from"./query-DSXC375t.js";import{a as g}from"./attendanceService-DiybS259.js";import{i as X,a as G,g as J,e as K}from"./camera-uGge9r08.js";import{d as Z,C as j,L as ee,m as se,c as te,g as ae,S as re,e as le,H as ce,M as ie,z as l}from"./ui-BANi3Jhe.js";import"./vendor-C8w-UNLI.js";import"./utils-ngrFHoWO.js";const ge=()=>{var C,S,I,O,A,L,E,T,H,R,D,F,M;const{user:o}=$(),[y,N]=n.useState(""),[h,v]=n.useState(new Date().toISOString().split("T")[0]),[f,k]=n.useState(""),u=q(),{data:r,isLoading:Y,error:B}=P(["my-attendance",y,h,f],()=>g.getAttendance({employeeId:o==null?void 0:o.employeeId,startDate:h,endDate:h,status:f})),{data:a}=P("attendance-status",()=>g.getAttendanceStatus(),{enabled:!!(o!=null&&o.employeeId),refetchInterval:3e4,refetchOnWindowFocus:!0}),b=Q(g.selfCheckIn,{onSuccess:()=>{l.success("Checked in successfully"),u.invalidateQueries("my-attendance"),u.invalidateQueries("attendance-status")},onError:s=>{var c,i;const t=((i=(c=s.response)==null?void 0:c.data)==null?void 0:i.error)||"Failed to check in";t.includes("Already checked in")?l.error("You have already checked in today. Please check out first."):t.includes("Already completed attendance")?l.error("You have already completed attendance for today"):l.error(t)}}),w=Q(g.selfCheckOut,{onSuccess:()=>{l.success("Checked out successfully"),u.invalidateQueries("my-attendance"),u.invalidateQueries("attendance-status")},onError:s=>{var c,i;const t=((i=(c=s.response)==null?void 0:c.data)==null?void 0:i.error)||"Failed to check out";t.includes("No active check-in")?l.error("Please check in first before checking out"):t.includes("Already checked out")?l.error("You have already checked out today"):l.error(t)}}),[d,x]=n.useState(!1),m=n.useRef(null),p=n.useRef(null);n.useEffect(()=>((async()=>{try{if(!d)return;if(!X()){l.error("Camera not available on this device"),x(!1);return}const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}},audio:!1});p.current=t,m.current&&(m.current.srcObject=t,await m.current.play())}catch(t){l.error((t==null?void 0:t.message)||"Unable to access camera"),x(!1)}})(),()=>{p.current&&(p.current.getTracks().forEach(t=>t.stop()),p.current=null)}),[d]);const _=async()=>{try{const s=m.current;if(!s)return;const t=document.createElement("canvas");t.width=s.videoWidth||640,t.height=s.videoHeight||480;const c=t.getContext("2d");c&&c.drawImage(s,0,0,t.width,t.height);const i=t.toDataURL("image/jpeg",.9);return await K(i)}catch{l.error("Failed to capture photo");return}},U=()=>{x(!1)},z=()=>x("checkin"),V=()=>x("checkout"),W=async()=>{try{const s=await _(),t=G(),c=await J().catch(()=>null);d==="checkin"?await b.mutateAsync({isRemote:!1,checkInSelfie:s,checkInLocation:c,deviceInfo:t}):d==="checkout"&&await w.mutateAsync({checkOutSelfie:s,checkOutLocation:c}),x(!1)}catch(s){l.error((s==null?void 0:s.message)||"Failed to record attendance")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Attendance"}),e.jsx("p",{className:"text-gray-600",children:"View your attendance records and history"})]})}),d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:d==="checkin"?"Check In Selfie":"Check Out Selfie"}),e.jsx("button",{onClick:U,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("video",{ref:m,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-64 bg-gray-900 rounded-lg"}),e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2",children:e.jsxs("button",{onClick:W,className:"bg-blue-600 text-white px-6 py-2 rounded-full hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Capture Photo"]})})]}),e.jsx("div",{className:"mt-4 text-sm text-gray-600 text-center",children:'Position your face in the camera frame and click "Capture Photo"'})]})}),a&&e.jsx("div",{className:"card p-4 bg-blue-50 border-blue-200",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(j,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Today's Status"}),e.jsx("p",{className:"text-sm text-blue-700",children:a.status.isCompleted?"Completed for today":a.status.canCheckOut?"Checked in - Ready to check out":a.status.canCheckIn?"Not checked in yet":"No attendance recorded"}),a.attendance&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[a.attendance.checkIn&&e.jsxs("div",{children:["Check In: ",new Date(a.attendance.checkIn).toLocaleTimeString()]}),a.attendance.checkOut&&e.jsxs("div",{children:["Check Out: ",new Date(a.attendance.checkOut).toLocaleTimeString()]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:z,disabled:b.isLoading||!((C=a==null?void 0:a.status)!=null&&C.canCheckIn),className:"card p-4 flex items-center justify-center gap-3 hover:bg-green-50 disabled:opacity-60 disabled:cursor-not-allowed",children:[e.jsx(ee,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-700",children:(S=a==null?void 0:a.status)!=null&&S.canCheckIn?"Check In (Selfie + Location)":"Already Checked In"})]}),e.jsxs("button",{onClick:V,disabled:w.isLoading||!((I=a==null?void 0:a.status)!=null&&I.canCheckOut),className:"card p-4 flex items-center justify-center gap-3 hover:bg-orange-50 disabled:opacity-60 disabled:cursor-not-allowed",children:[e.jsx(se,{className:"h-5 w-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-700",children:(O=a==null?void 0:a.status)!=null&&O.canCheckOut?"Check Out (Selfie + Location)":(A=a==null?void 0:a.status)!=null&&A.isCompleted?"Already Checked Out":"Check In First"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(te,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Present Days"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:((E=(L=r==null?void 0:r.data)==null?void 0:L.attendances)==null?void 0:E.filter(s=>s.status==="PRESENT").length)||0})]})]})}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(ae,{className:"h-5 w-5 text-red-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Absent Days"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:((H=(T=r==null?void 0:r.data)==null?void 0:T.attendances)==null?void 0:H.filter(s=>s.status==="ABSENT").length)||0})]})]})}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(j,{className:"h-5 w-5 text-yellow-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Late Days"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:((D=(R=r==null?void 0:r.data)==null?void 0:R.attendances)==null?void 0:D.filter(s=>s.status==="LATE").length)||0})]})]})})]}),e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search attendance records...",className:"input pl-10",value:y,onChange:s=>N(s.target.value)})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",className:"input",value:h,onChange:s=>v(s.target.value)}),e.jsxs("select",{className:"input",value:f,onChange:s=>k(s.target.value),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"PRESENT",children:"Present"}),e.jsx("option",{value:"ABSENT",children:"Absent"}),e.jsx("option",{value:"LATE",children:"Late"}),e.jsx("option",{value:"EARLY_LEAVE",children:"Early Leave"}),e.jsx("option",{value:"HALF_DAY",children:"Half Day"})]}),e.jsxs("button",{className:"btn btn-outline btn-md",onClick:()=>{N(""),v(new Date().toISOString().split("T")[0]),k("")},children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Clear"]})]})]})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"My Attendance Records"})}),e.jsx("div",{className:"p-6",children:Y?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Loading attendance records..."})]}):B?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-red-600",children:"Error loading attendance records"})}):(M=(F=r==null?void 0:r.data)==null?void 0:F.attendances)!=null&&M.length?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Check In"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Check Out"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Selfies"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Location"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Working Hours"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Details"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.data.attendances.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(s.date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.checkIn?new Date(s.checkIn).toLocaleTimeString():"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.checkOut?new Date(s.checkOut).toLocaleTimeString():"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${s.status==="PRESENT"?"bg-green-100 text-green-800":s.status==="ABSENT"?"bg-red-100 text-red-800":s.status==="LATE"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:s.status}),s.isRemote&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-blue-700 bg-blue-50 rounded",children:[e.jsx(ce,{className:"w-3 h-3"}),"Remote"]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[s.checkInSelfie?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("img",{src:s.checkInSelfie,alt:"Check-In",className:"w-16 h-16 object-cover rounded-lg border-2 border-green-500 cursor-pointer hover:scale-110 transition-transform shadow-md",onClick:()=>window.open(s.checkInSelfie,"_blank"),title:"Click to view check-in selfie"}),e.jsx("span",{className:"text-xs text-green-700 mt-1",children:"🌅 In"})]}):null,s.checkOutSelfie?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("img",{src:s.checkOutSelfie,alt:"Check-Out",className:"w-16 h-16 object-cover rounded-lg border-2 border-orange-500 cursor-pointer hover:scale-110 transition-transform shadow-md",onClick:()=>window.open(s.checkOutSelfie,"_blank"),title:"Click to view check-out selfie"}),e.jsx("span",{className:"text-xs text-orange-700 mt-1",children:"🌆 Out"})]}):null,!s.checkInSelfie&&!s.checkOutSelfie&&e.jsx("span",{className:"text-gray-400 text-xs",children:"No photos"})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:s.location?e.jsxs("a",{href:`https://www.google.com/maps?q=${s.location.latitude},${s.location.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-blue-600 hover:text-blue-800",title:s.location.address,children:[e.jsx(ie,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs",children:"View Map"})]}):e.jsx("span",{className:"text-gray-400 text-xs",children:"No location"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[s.totalHours&&e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["⏱️ Total: ",s.totalHours,"h"]}),s.regularHours&&e.jsxs("div",{className:"text-xs text-blue-600",children:["📊 Regular: ",s.regularHours,"h"]}),s.overtimeHours&&s.overtimeHours>0&&e.jsxs("div",{className:"text-xs text-orange-600 font-medium",children:["⏰ OT: +",s.overtimeHours,"h"]}),s.breakHours&&s.breakHours>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:["🍽️ Break: ",s.breakHours,"h"]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[s.shift&&e.jsxs("span",{className:"text-xs text-purple-600",children:["🔄 ",s.shift.name]}),s.notes&&e.jsxs("span",{className:"text-xs text-gray-600",title:s.notes,children:["📝 ",s.notes.substring(0,20),s.notes.length>20?"...":""]})]})})]},s.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(j,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No attendance records"}),e.jsx("p",{className:"text-gray-600",children:"Your attendance records will appear here"})]})})]})]})};export{ge as default};
//# sourceMappingURL=MyAttendance-CV3rRXRs.js.map
