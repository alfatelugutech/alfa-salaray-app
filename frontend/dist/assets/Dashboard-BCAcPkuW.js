var Ae=Object.defineProperty;var Re=(s,r,c)=>r in s?Ae(s,r,{enumerable:!0,configurable:!0,writable:!0,value:c}):s[r]=c;var I=(s,r,c)=>Re(s,typeof r!="symbol"?r+"":r,c);import{j as e,c as Te,u as Se,a as Ee}from"./index-B0dpTzod.js";import{r as i,u as Oe}from"./router-BXhMSvr3.js";import{u as Me,a as L,b as fe}from"./query-DSXC375t.js";import{a as A}from"./attendanceService-Djx-h3fj.js";import{l as je}from"./leaveService-BKIADpwc.js";import{e as De}from"./employeeService-CpNx_TMG.js";import{b as Pe,c as Fe,W as qe,X as q,R as Ue,d as T,z as o,C as R,M as F}from"./ui-BANi3Jhe.js";import{g as U,a as He,c as _e}from"./camera-uGge9r08.js";import{l as ye}from"./locationTrackingService-mUJnMJ8F.js";import"./vendor-C8w-UNLI.js";import"./utils-ngrFHoWO.js";class We{constructor(r=3e4){I(this,"intervalId",null);I(this,"attendanceId",null);I(this,"isTracking",!1);I(this,"trackingInterval",3e4);this.trackingInterval=r}async startTracking(r){if(this.isTracking){console.log("Location tracking already active");return}this.attendanceId=r,this.isTracking=!0,console.log("🚀 Starting location tracking for attendance:",r),await this.trackCurrentLocation(),this.intervalId=setInterval(async()=>{this.isTracking&&this.attendanceId&&await this.trackCurrentLocation()},this.trackingInterval)}async stopTracking(){if(!this.isTracking||!this.attendanceId){console.log("No active tracking to stop");return}console.log("🛑 Stopping location tracking for attendance:",this.attendanceId),this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null);try{await ye.stopTracking(this.attendanceId),console.log("✅ Location tracking stopped successfully")}catch(r){console.error("❌ Error stopping location tracking:",r)}this.isTracking=!1,this.attendanceId=null}async trackCurrentLocation(){if(this.attendanceId)try{const r=await U(),c={attendanceId:this.attendanceId,latitude:r.latitude,longitude:r.longitude,accuracy:r.accuracy,address:r.address};await ye.trackLocation(c),console.log("📍 Location tracked:",{lat:r.latitude,lng:r.longitude,address:r.address,timestamp:new Date().toISOString()})}catch(r){console.error("❌ Error tracking location:",r)}}getStatus(){return{isTracking:this.isTracking,attendanceId:this.attendanceId}}setInterval(r){this.trackingInterval=r,this.isTracking&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=setInterval(async()=>{this.isTracking&&this.attendanceId&&await this.trackCurrentLocation()},this.trackingInterval))}}const ve=new We,$e=()=>{const[s,r]=i.useState(null),[c,p]=i.useState(!1),[n,h]=i.useState(null),[l,b]=i.useState(null),x=async()=>{p(!0),b(null);try{const j=await Te();r(j.isHealthy),h(new Date),j.isHealthy||b(j.error)}catch(j){r(!1),b(j.message),h(new Date)}finally{p(!1)}};return i.useEffect(()=>{x()},[]),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Backend Connection"}),e.jsx("button",{onClick:x,disabled:c,className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200 disabled:opacity-50",children:c?"Testing...":"Test Again"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[s===null?e.jsx(Pe,{className:"w-5 h-5 text-gray-400"}):s?e.jsx(Fe,{className:"w-5 h-5 text-green-500"}):e.jsx(qe,{className:"w-5 h-5 text-red-500"}),e.jsxs("div",{className:"flex-1",children:[s===null&&e.jsx("p",{className:"text-gray-600",children:"Testing connection..."}),s===!0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 font-medium",children:"✅ Backend is running"}),n&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Last checked: ",n.toLocaleTimeString()]})]}),s===!1&&e.jsxs("div",{children:[e.jsx("p",{className:"text-red-600 font-medium",children:"❌ Cannot connect to backend"}),l&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l}),n&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Last checked: ",n.toLocaleTimeString()]})]})]})]}),s===!1&&e.jsxs("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800 mb-2",children:"Troubleshooting:"}),e.jsxs("ul",{className:"text-xs text-red-700 space-y-1",children:[e.jsx("li",{children:"• Check if the backend server is running"}),e.jsx("li",{children:"• Verify your internet connection"}),e.jsx("li",{children:"• Try refreshing the page"}),e.jsx("li",{children:"• Contact support if the issue persists"})]})]})]})},ze=({isOpen:s,onClose:r,onCapture:c,title:p})=>{const n=i.useRef(null),h=i.useRef(null),l=i.useRef(null),[b,x]=i.useState(!1),[j,O]=i.useState("user");i.useEffect(()=>(s?k():S(),()=>{S()}),[s,j]);const k=async()=>{try{const g={video:{facingMode:j,width:{ideal:1280},height:{ideal:720}},audio:!1},u=await navigator.mediaDevices.getUserMedia(g);l.current=u,n.current&&(n.current.srcObject=u,n.current.play(),x(!0))}catch(g){throw console.error("❌ Camera access failed:",g),new Error("Camera access denied or not available")}},S=()=>{l.current&&(l.current.getTracks().forEach(g=>g.stop()),l.current=null),x(!1)},H=()=>{if(!n.current||!h.current)return;const g=n.current,u=h.current,E=u.getContext("2d");if(!E)return;u.width=g.videoWidth,u.height=g.videoHeight,E.drawImage(g,0,0,u.width,u.height);const t=u.toDataURL("image/jpeg",.8);S(),c(t),r()},w=()=>{O(g=>g==="user"?"environment":"user")};return s?e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center",children:e.jsxs("div",{className:"relative w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-white text-lg font-semibold",children:p}),e.jsx("button",{onClick:r,className:"text-white hover:text-gray-300 transition-colors",children:e.jsx(q,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden",children:[e.jsx("video",{ref:n,className:"w-full h-64 object-cover",playsInline:!0,muted:!0}),e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("button",{onClick:w,className:"bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-70 transition-all",title:"Switch Camera",children:e.jsx(Ue,{className:"w-5 h-5"})})}),e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2",children:e.jsx("button",{onClick:H,disabled:!b,className:"bg-white w-16 h-16 rounded-full flex items-center justify-center shadow-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:e.jsx(T,{className:"w-8 h-8 text-gray-800"})})})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-white text-sm",children:b?"Position yourself in the frame and tap the camera button":"Starting camera..."})}),e.jsx("canvas",{ref:h,className:"hidden"})]})}):null},Be=()=>{const[s,r]=i.useState(new Date);return i.useEffect(()=>{const c=setInterval(()=>{r(new Date)},1e3);return()=>clearInterval(c)},[]),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{className:"text-lg",children:"🕐"}),e.jsx("span",{className:"font-mono font-medium",children:s.toLocaleTimeString()}),e.jsx("span",{className:"text-xs text-gray-500",children:s.toLocaleDateString()})]})},rt=()=>{var $,z,B,G,Q,V,K,Y,X,J,Z,ee,te,se,ae,re,le,ne,oe,ie,ce,de,me,xe,he,ge,ue,be,pe;const{user:s}=Se(),r=Oe();console.log("👤 Dashboard user data:",s),console.log("🔑 User role:",s==null?void 0:s.role),console.log("🆔 User ID:",s==null?void 0:s.id);const[c,p]=i.useState(!1),[n,h]=i.useState(null),[l,b]=i.useState(null),[x,j]=i.useState(!1),[O,k]=i.useState(!1),[S,H]=i.useState("overview"),w=Me(),g=()=>{var a,m;return(a=t==null?void 0:t.status)!=null&&a.isCompleted?{type:"completed",message:"🎉 Work day completed successfully!",color:"green",icon:"✅"}:(m=t==null?void 0:t.status)!=null&&m.canCheckOut?{type:"checkout",message:"🌆 Ready for smart check-out",color:"orange",icon:"🕐"}:{type:"checkin",message:"🌅 Ready for smart check-in",color:"blue",icon:"🚀"}},{data:u,error:E}=L("my-attendance",()=>A.getAttendance({employeeId:s==null?void 0:s.employeeId}),{enabled:!!(s!=null&&s.employeeId),retry:2,retryDelay:1e3,refetchInterval:3e4,refetchOnWindowFocus:!0,onError:a=>{a.code!=="NETWORK_ERROR"&&console.error("Attendance data fetch error:",a)}}),{data:t}=L("attendance-status",()=>A.getAttendanceStatus(),{enabled:!!(s!=null&&s.employeeId),refetchInterval:3e4,refetchOnWindowFocus:!0}),{data:C,error:Ne}=L("my-leave-requests",()=>je.getLeaveRequests({employeeId:s==null?void 0:s.employeeId}),{enabled:!!(s!=null&&s.employeeId),retry:2,retryDelay:1e3,onError:a=>{a.code!=="NETWORK_ERROR"&&console.error("Leave data fetch error:",a)}}),{data:M,error:ke}=L("employee-stats",()=>De.getEmployeeStats(),{enabled:(s==null?void 0:s.role)==="SUPER_ADMIN"||(s==null?void 0:s.role)==="HR_MANAGER",retry:2,retryDelay:1e3,onError:a=>{a.code!=="NETWORK_ERROR"&&console.error("Employee stats fetch error:",a)}}),{data:d,error:we}=L("attendance-stats",()=>A.getAttendanceStats(),{enabled:(s==null?void 0:s.role)==="SUPER_ADMIN"||(s==null?void 0:s.role)==="HR_MANAGER",retry:2,retryDelay:1e3,onError:a=>{a.code!=="NETWORK_ERROR"&&console.error("Attendance stats fetch error:",a)}}),{data:D,error:Ce}=L("leave-stats",()=>je.getLeaveStats(),{enabled:(s==null?void 0:s.role)==="SUPER_ADMIN"||(s==null?void 0:s.role)==="HR_MANAGER",retry:2,retryDelay:1e3,onError:a=>{a.code!=="NETWORK_ERROR"&&console.error("Leave stats fetch error:",a)}}),y=fe(A.selfCheckIn,{onSuccess:a=>{w.invalidateQueries("my-attendance"),w.invalidateQueries("attendance-status"),a!=null&&a.id&&(ve.startTracking(a.id),console.log("🚀 Location tracking started for attendance:",a.id)),o.success("✅ Check-in completed successfully! Location tracking started."),p(!1),h(null),b(null)},onError:a=>{var N,f;const m=((f=(N=a.response)==null?void 0:N.data)==null?void 0:f.error)||"Failed to check in";m.includes("already marked")?o.error("You have already checked in today. Please check out first."):m.includes("Already completed attendance")?o.error("Attendance already completed for today"):o.error(m)}}),v=fe(A.selfCheckOut,{onSuccess:()=>{w.invalidateQueries("my-attendance"),w.invalidateQueries("attendance-status"),ve.stopTracking(),console.log("🛑 Location tracking stopped after check-out"),o.success("✅ Check-out completed successfully! Your attendance has been recorded with selfie and location."),p(!1),h(null),b(null)},onError:a=>{var N,f;const m=((f=(N=a.response)==null?void 0:N.data)==null?void 0:f.error)||"Failed to check out";m.includes("No active check-in")?o.error("❌ Please check in first before checking out"):m.includes("Already checked out")?o.error("❌ You have already checked out today"):m.includes("User ID required")?o.error("❌ Authentication error. Please login again."):o.error(`❌ Check-out failed: ${m}`)}});i.useEffect(()=>{if(l&&n&&!y.isLoading&&!v.isLoading){console.log("🧠 Smart system: Both selfie and location ready, auto-submitting...");const a=l.length>1e5?1e3:500,m=setTimeout(()=>{_()},a);return()=>clearTimeout(m)}},[l,n,y.isLoading,v.isLoading]);const P=async()=>{await Le()},Le=async()=>{try{const a=await U();h(a),console.log("📍 Location captured automatically:",{hasLocation:!!a,locationData:a}),o.success("📍 Location captured automatically!")}catch(a){console.log("❌ Location capture failed:",a),o.error(a.message||"Failed to get location");return}k(!0)},Ie=a=>{b(a),console.log("📸 Selfie captured from live camera:",{hasSelfie:!!a,selfieLength:(a==null?void 0:a.length)||0}),o.success("📸 Selfie captured successfully!"),k(!1),n?o("✅ Both selfie and location ready! Attendance will be marked automatically.",{icon:"ℹ️"}):o("📍 Selfie captured! Waiting for location data...",{icon:"ℹ️"})},_=()=>{var N;const a=He();console.log("🔍 Auto-submit state check:",{hasSelfie:!!l,selfieLength:(l==null?void 0:l.length)||0,hasLocation:!!n,locationData:n,attendanceStatus:t==null?void 0:t.status,user:s,userId:s==null?void 0:s.id,isAuthenticated:Ee.isAuthenticated()});const m=(N=t==null?void 0:t.status)==null?void 0:N.canCheckOut;if(m){if(!l){o.error("❌ Check-out requires a selfie. Please capture your selfie first.");return}if(!n){o.error("❌ Check-out requires location. Please allow location access.");return}console.log("✅ Check-out requirements validated: Selfie + Location captured")}else{if(!l){o.error("❌ Check-in requires a selfie. Please capture your selfie first.");return}if(!n){o.error("❌ Check-in requires location. Please allow location access.");return}console.log("✅ Check-in requirements validated: Selfie + Location captured")}if(m){const f={notes:void 0,checkOutSelfie:l||void 0,checkOutLocation:n||void 0};console.log("🔍 Check-out data being sent:",{hasSelfie:!!l,selfieLength:(l==null?void 0:l.length)||0,selfiePreview:(l==null?void 0:l.substring(0,50))+"...",hasLocation:!!n,locationData:n,checkOutData:f,fullPayload:{notes:void 0,checkOutSelfie:l||void 0,checkOutLocation:n||void 0}}),o.loading("🎯 Automatically checking out...",{duration:2e3}),v.mutate(f)}else{const f={isRemote:!1,notes:void 0,checkInSelfie:l||void 0,checkInLocation:n||void 0,deviceInfo:a||void 0,shiftId:null};console.log("🔍 Check-in data being sent:",{hasSelfie:!!l,selfieLength:(l==null?void 0:l.length)||0,selfiePreview:(l==null?void 0:l.substring(0,50))+"...",hasLocation:!!n,locationData:n,checkInData:f,fullPayload:{isRemote:!1,notes:void 0,checkInSelfie:l||void 0,checkInLocation:n||void 0,deviceInfo:a||void 0,shiftId:null}}),o.loading("🎯 Automatically checking in...",{duration:2e3}),y.mutate(f)}},W=(s==null?void 0:s.role)==="SUPER_ADMIN"||(s==null?void 0:s.role)==="HR_MANAGER";return e.jsxs("div",{className:"p-6",children:[e.jsx($e,{}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"🎉 Smart Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"AI-powered workforce management system"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Be,{}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse mr-2"}),"Live Updates"]})]})]}),W?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Admin Dashboard"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time workforce management"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Updated"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:new Date().toLocaleTimeString()})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:(M==null?void 0:M.totalEmployees)||0}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"All Employees"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-900",children:"Present Today"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:(d==null?void 0:d.presentCount)||0}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Active Employees"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-orange-900",children:"Late Today"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:(d==null?void 0:d.lateCount)||0}),e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Late Arrivals"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-purple-900",children:"Pending Leaves"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:(D==null?void 0:D.pendingRequests)||0}),e.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"Awaiting Approval"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Today's Attendance Overview"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Attendance Rate"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:d!=null&&d.attendanceRate?`${Math.round(d.attendanceRate)}%`:"0%"})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:(d==null?void 0:d.totalRecords)||0})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Absent Today"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:(d==null?void 0:d.absentCount)||0})]})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[t&&e.jsx("div",{className:`p-6 rounded-lg border-2 ${($=t.status)!=null&&$.isCompleted?"bg-green-50 border-green-200":(z=t.status)!=null&&z.canCheckOut?"bg-orange-50 border-orange-200":"bg-blue-50 border-blue-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Today's Status"}),e.jsx("p",{className:"text-sm text-gray-600",children:(B=t.status)!=null&&B.isCompleted?"✅ Work day completed":(G=t.status)!=null&&G.canCheckOut?"🕐 Ready for check-out":"🚀 Ready for check-in"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Current Time"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:new Date().toLocaleTimeString()})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"My Attendance"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:((V=(Q=u==null?void 0:u.data)==null?void 0:Q.attendances)==null?void 0:V.length)||0}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Total Records"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-900",children:"My Leave Requests"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:((Y=(K=C==null?void 0:C.data)==null?void 0:K.leaveRequests)==null?void 0:Y.length)||0}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"All Requests"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-purple-900",children:"Pending Leaves"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:((J=(X=C==null?void 0:C.data)==null?void 0:X.leaveRequests)==null?void 0:J.filter(a=>a.status==="PENDING").length)||0}),e.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"Awaiting Approval"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-orange-900",children:"Today's Hours"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:(Z=t==null?void 0:t.attendance)!=null&&Z.totalHours?`${parseFloat(t.attendance.totalHours.toString()).toFixed(1)}h`:"0h"}),e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:(ee=t==null?void 0:t.attendance)!=null&&ee.overtimeHours&&parseFloat(t.attendance.overtimeHours.toString())>0?`+${parseFloat(t.attendance.overtimeHours.toString()).toFixed(1)}h OT`:"Regular Hours"})]})]}),(t==null?void 0:t.attendance)&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Today's Attendance Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Check-in Time"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:t.attendance.checkIn?new Date(t.attendance.checkIn).toLocaleTimeString():"Not checked in"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Check-out Time"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:t.attendance.checkOut?new Date(t.attendance.checkOut).toLocaleTimeString():"Not checked out"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Status"}),e.jsx("p",{className:`text-lg font-bold ${t.attendance.status==="PRESENT"?"text-green-600":t.attendance.status==="LATE"?"text-orange-600":"text-red-600"}`,children:t.attendance.status||"Not marked"})]})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsx("div",{className:"space-y-2",children:W?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r("/attendance"),className:"w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors cursor-pointer",children:"Mark Attendance"}),e.jsx("button",{onClick:()=>r("/employees"),className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded hover:bg-gray-300 transition-colors cursor-pointer",children:"View Employees"}),e.jsx("button",{onClick:()=>r("/leave-requests"),className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded hover:bg-gray-300 transition-colors cursor-pointer",children:"Manage Leave Requests"}),(s==null?void 0:s.role)==="SUPER_ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r("/employees"),className:"w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700 transition-colors cursor-pointer",children:"User & Role Management"}),e.jsx("button",{onClick:()=>r("/shifts"),className:"w-full bg-orange-600 text-white py-2 px-4 rounded hover:bg-orange-700 transition-colors cursor-pointer",children:"Shift Management"}),e.jsx("button",{onClick:()=>r("/settings"),className:"w-full bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 transition-colors cursor-pointer",children:"System Settings"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>p(!0),className:"w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition-colors cursor-pointer",children:"Mark Self Attendance"}),e.jsx("button",{onClick:()=>r("/my-attendance"),className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded hover:bg-gray-300 transition-colors cursor-pointer",children:"View My Attendance"}),e.jsx("button",{onClick:()=>r("/my-leave"),className:"w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors cursor-pointer",children:"Request Leave"}),e.jsx("button",{onClick:()=>r("/profile"),className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded hover:bg-gray-300 transition-colors cursor-pointer",children:"View My Profile"})]})})]}),(s==null?void 0:s.role)==="SUPER_ADMIN"&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Super Admin Features"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"font-semibold text-purple-900 mb-2",children:"User Management"}),e.jsx("p",{className:"text-sm text-purple-700 mb-3",children:"Manage employees and users"}),e.jsx("button",{onClick:()=>r("/employees"),className:"w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700 text-sm transition-colors cursor-pointer",children:"Manage Employees"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[e.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:"Shift Management"}),e.jsx("p",{className:"text-sm text-orange-700 mb-3",children:"Create and manage work shifts"}),e.jsx("button",{onClick:()=>r("/shifts"),className:"w-full bg-orange-600 text-white py-2 px-4 rounded hover:bg-orange-700 text-sm transition-colors cursor-pointer",children:"Manage Shifts"})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"System Settings"}),e.jsx("p",{className:"text-sm text-red-700 mb-3",children:"Configure system-wide settings"}),e.jsx("button",{onClick:()=>r("/settings"),className:"w-full bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 text-sm transition-colors cursor-pointer",children:"System Config"})]}),e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg border border-indigo-200",children:[e.jsx("h3",{className:"font-semibold text-indigo-900 mb-2",children:"Payroll Management"}),e.jsx("p",{className:"text-sm text-indigo-700 mb-3",children:"Manage employee salaries"}),e.jsx("button",{onClick:()=>r("/payroll"),className:"w-full bg-indigo-600 text-white py-2 px-4 rounded hover:bg-indigo-700 text-sm transition-colors cursor-pointer",children:"Manage Payroll"})]}),e.jsxs("div",{className:"bg-teal-50 p-4 rounded-lg border border-teal-200",children:[e.jsx("h3",{className:"font-semibold text-teal-900 mb-2",children:"Attendance Reports"}),e.jsx("p",{className:"text-sm text-teal-700 mb-3",children:"View attendance analytics"}),e.jsx("button",{onClick:()=>r("/attendance"),className:"w-full bg-teal-600 text-white py-2 px-4 rounded hover:bg-teal-700 text-sm transition-colors cursor-pointer",children:"View Attendance"})]}),e.jsxs("div",{className:"bg-pink-50 p-4 rounded-lg border border-pink-200",children:[e.jsx("h3",{className:"font-semibold text-pink-900 mb-2",children:"Leave Management"}),e.jsx("p",{className:"text-sm text-pink-700 mb-3",children:"Manage leave requests"}),e.jsx("button",{onClick:()=>r("/leave"),className:"w-full bg-pink-600 text-white py-2 px-4 rounded hover:bg-pink-700 text-sm transition-colors cursor-pointer",children:"Manage Leaves"})]})]})]}),e.jsxs("div",{className:"mt-8 p-4 bg-green-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-900",children:"System Status"}),e.jsx("p",{className:"text-green-700",children:"✅ All systems operational"}),(E||Ne||ke||we||Ce)&&e.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded",children:e.jsx("p",{className:"text-yellow-800 text-sm",children:"⚠️ Some data may not be up to date due to network issues. Please refresh the page."})})]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-lg mx-auto max-h-[95vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b sticky top-0 bg-white z-10",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(R,{className:"w-5 h-5 mr-2"}),"Mark Attendance"]}),e.jsx("button",{onClick:()=>{p(!1),b(null),h(null)},className:"text-gray-400 hover:text-gray-600",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[(()=>{const a=g();return e.jsxs("div",{className:`mb-6 p-4 rounded-lg border-2 ${a.color==="green"?"bg-green-50 border-green-200":a.color==="orange"?"bg-orange-50 border-orange-200":"bg-blue-50 border-blue-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${a.color==="green"?"bg-green-500":a.color==="orange"?"bg-orange-500":"bg-blue-500"}`}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[a.icon," ",a.message]})]}),a.type!=="completed"&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx("p",{className:"text-xs text-gray-600",children:"🧠 Smart system will handle location + selfie automatically"})})]})})(),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Automatic Data Capture"})]}),e.jsx("p",{className:"text-sm text-blue-700",children:"Date, time, and status will be automatically captured when you take your selfie."})]}),!l&&!n?e.jsxs("div",{className:"p-8 bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 border-2 border-blue-400 rounded-xl shadow-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:`w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg ${(te=t==null?void 0:t.status)!=null&&te.canCheckOut?"bg-orange-600":(se=t==null?void 0:t.status)!=null&&se.isCompleted?"bg-green-600":"bg-blue-600"}`,children:e.jsx(T,{className:"w-10 h-10 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:(ae=t==null?void 0:t.status)!=null&&ae.isCompleted?"✅ Attendance Completed":(re=t==null?void 0:t.status)!=null&&re.canCheckOut?"📸 Check-Out Selfie":"📸 Check-In Selfie"}),e.jsx("p",{className:"text-base text-gray-700",children:(le=t==null?void 0:t.status)!=null&&le.isCompleted?"🎉 You have completed your attendance for today":(ne=t==null?void 0:t.status)!=null&&ne.canCheckOut?"🌆 Take your check-out selfie":"🌅 Take your check-in selfie"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:(oe=t==null?void 0:t.status)!=null&&oe.isCompleted?"Great job! See you tomorrow.":(ie=t==null?void 0:t.status)!=null&&ie.canCheckOut?"🌆 One-click smart checkout with selfie & location":"🌅 One-click smart check-in with selfie & location"})]}),e.jsx("button",{type:"button",onClick:P,disabled:x||((ce=t==null?void 0:t.status)==null?void 0:ce.isCompleted),className:`w-full flex items-center justify-center gap-3 px-8 py-4 text-white text-xl font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed shadow-xl transform transition-all duration-300 hover:scale-105 hover:shadow-2xl ${(de=t==null?void 0:t.status)!=null&&de.isCompleted?"bg-gray-500 cursor-not-allowed":(me=t==null?void 0:t.status)!=null&&me.canCheckOut?"bg-gradient-to-r from-orange-500 via-orange-600 to-orange-700 hover:from-orange-600 hover:via-orange-700 hover:to-orange-800":"bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:from-blue-600 hover:via-blue-700 hover:to-blue-800"}`,children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"}),"Opening Camera..."]}):(xe=t==null?void 0:t.status)!=null&&xe.isCompleted?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-6 h-6",children:"✅"}),"Attendance Completed"]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-6 h-6"}),"📸 ",(he=t==null?void 0:t.status)!=null&&he.canCheckOut?"Smart Check-Out":"Smart Check-In"]})}),e.jsxs("p",{className:"text-xs text-gray-600 mt-4 text-center bg-white/50 p-3 rounded-lg",children:["ℹ️ ",(ge=t==null?void 0:t.status)!=null&&ge.canCheckOut?"Smart Check-Out: Automatic location + live camera selfie":"Smart Check-In: Automatic location + live camera selfie"]})]}):e.jsxs(e.Fragment,{children:[l&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-lg font-semibold",children:"📸 Attendance Selfie ✅"}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:l,alt:"Attendance Selfie",className:"w-full h-80 object-cover rounded-xl border-4 border-green-500 shadow-lg"}),e.jsxs("button",{type:"button",onClick:()=>{b(null),h(null)},className:"absolute top-3 right-3 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 flex items-center gap-2 shadow-lg",children:[e.jsx(T,{className:"w-5 h-5"}),"Retake"]})]}),l&&n&&e.jsx("div",{className:"mt-4 p-4 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-lg shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("p",{className:"text-green-800 font-medium",children:"🧠 Smart system ready! Both selfie and location captured"}),e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("button",{type:"button",onClick:_,disabled:y.isLoading||v.isLoading,className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-lg font-bold text-lg hover:from-green-600 hover:to-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 shadow-lg transform transition-all duration-300 hover:scale-105",children:y.isLoading||v.isLoading?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"}),(ue=t==null?void 0:t.status)!=null&&ue.canCheckOut?"Checking Out...":"Checking In..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-6 h-6"}),(be=t==null?void 0:t.status)!=null&&be.canCheckOut?"Complete Check-Out":"Complete Check-In"]})})]})})]}),n&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Your Location ✅"}),e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-green-600"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium text-green-900",children:n.address||`${n.latitude.toFixed(6)}, ${n.longitude.toFixed(6)}`})})]})})]})]}),l&&n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-800",children:"Time will be automatically captured"})]}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"Current time will be used for check-in/check-out"})]}),e.jsx("div",{className:"p-2 bg-blue-50 border border-blue-200 rounded text-center",children:e.jsx("p",{className:"text-xs text-blue-700",children:"✅ Selfie, Location, Device & IP captured"})})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>p(!1),className:"flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{type:"button",onClick:async()=>{try{const a=await _e();a.hasPermission?o.success("✅ Camera is working perfectly!"):o.error(a.message)}catch(a){o.error("Camera test failed: "+a.message)}},className:"bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors mr-2",children:"Test Camera"}),e.jsx("button",{type:"button",onClick:P,disabled:x||y.isLoading||v.isLoading,className:"flex-1 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 disabled:opacity-50",children:x?"Capturing...":y.isLoading?"Checking In...":v.isLoading?"Checking Out...":"Take Selfie & Mark Attendance"})]})]})]})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-lg mx-auto max-h-[95vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b sticky top-0 bg-white z-10",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(R,{className:"w-5 h-5 mr-2"}),"Mark Attendance"]}),e.jsx("button",{onClick:()=>p(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(q,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4",children:l?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:l,alt:"Selfie",className:"w-32 h-32 object-cover rounded-lg mx-auto border-2 border-green-500"}),e.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs",children:"✓"})]}):e.jsx("div",{className:"w-32 h-32 bg-gray-100 rounded-lg mx-auto flex items-center justify-center border-2 border-dashed border-gray-300",children:e.jsx(T,{className:"w-8 h-8 text-gray-400"})})}),e.jsx("div",{className:"mb-4",children:n?e.jsxs("div",{className:"flex items-center justify-center text-green-600",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"Location captured"})]}):e.jsxs("div",{className:"flex items-center justify-center text-gray-400",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"Getting location..."})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{type:"button",onClick:()=>k(!0),disabled:x,className:"w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 disabled:opacity-50 transition-colors",children:l?"Retake Selfie":"Take Selfie"}),e.jsx("button",{type:"button",onClick:async()=>{try{const a=await U();h(a),o.success("Location updated!")}catch(a){o.error("Failed to get location: "+a.message)}},disabled:x,className:"w-full bg-gray-600 text-white py-2 px-4 rounded hover:bg-gray-700 disabled:opacity-50 transition-colors",children:"Update Location"})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx("button",{type:"button",onClick:P,disabled:x||y.isLoading||v.isLoading,className:"w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 disabled:opacity-50 transition-colors",children:x?"Capturing...":y.isLoading?"Checking In...":v.isLoading?"Checking Out...":"Mark Attendance"})})]})})]})}),e.jsx(ze,{isOpen:O,onClose:()=>k(!1),onCapture:Ie,title:(pe=t==null?void 0:t.status)!=null&&pe.canCheckOut?"Check-Out Selfie":"Check-In Selfie"})]})};export{rt as default};
//# sourceMappingURL=Dashboard-BCAcPkuW.js.map
