import{b as y,j as e}from"./index-mRQHkU_F.js";import{r as N}from"./router-BXhMSvr3.js";import{u as U,a as R,b as v}from"./query-DSXC375t.js";import{e as K}from"./employeeService-DwRPqA0A.js";import{P as L,K as M,q as Q,N as $,U as T,i as I,T as O,z as g}from"./ui-phtE4UZ1.js";import"./vendor-C8w-UNLI.js";import"./utils-ngrFHoWO.js";const f={async getRoles(){return(await y.get("/roles")).data.data},async getRole(a){return(await y.get(`/roles/${a}`)).data.data},async createRole(a){return(await y.post("/roles",a)).data.data},async updateRole(a,d){return(await y.put(`/roles/${a}`,d)).data.data},async deleteRole(a){await y.delete(`/roles/${a}`)},async assignRole(a){return(await y.post("/roles/assign",a)).data.data},async unassignRole(a,d){await y.delete(`/roles/unassign/${a}/${d}`)}},_={async getPermissions(){return(await y.get("/permissions")).data}},se=()=>{var A;const[a,d]=N.useState(!1),[h,p]=N.useState(null),[o,l]=N.useState(!1),[j,b]=N.useState(null),[c,i]=N.useState(""),n=U(),{data:t,isLoading:u}=R("roles",f.getRoles),{data:m}=R("permissions",_.getPermissions),{data:w}=R("employees",()=>K.getEmployees({page:1,limit:1e3})),C=v(s=>f.createRole(s),{onSuccess:()=>{n.invalidateQueries({queryKey:["roles"]}),d(!1),g.success("Role created successfully")},onError:s=>{var r,x;g.error(((x=(r=s.response)==null?void 0:r.data)==null?void 0:x.error)||"Failed to create role")}}),S=v(({id:s,data:r})=>f.updateRole(s,r),{onSuccess:()=>{n.invalidateQueries({queryKey:["roles"]}),p(null),g.success("Role updated successfully")},onError:s=>{var r,x;g.error(((x=(r=s.response)==null?void 0:r.data)==null?void 0:x.error)||"Failed to update role")}}),E=v(s=>f.deleteRole(s),{onSuccess:()=>{n.invalidateQueries({queryKey:["roles"]}),g.success("Role deleted successfully")},onError:s=>{var r,x;g.error(((x=(r=s.response)==null?void 0:r.data)==null?void 0:x.error)||"Failed to delete role")}}),k=v(s=>f.assignRole(s),{onSuccess:()=>{n.invalidateQueries({queryKey:["roles"]}),l(!1),g.success("Role assigned successfully")},onError:s=>{var r,x;g.error(((x=(r=s.response)==null?void 0:r.data)==null?void 0:x.error)||"Failed to assign role")}}),P=s=>{C.mutate(s)},q=s=>{h&&S.mutate({id:h.id,data:s})},D=s=>{window.confirm("Are you sure you want to delete this role?")&&E.mutate(s)},z=s=>{k.mutate(s)},F=(t||[]).filter(s=>{var r;return s.name.toLowerCase().includes(c.toLowerCase())||((r=s.description)==null?void 0:r.toLowerCase().includes(c.toLowerCase()))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Role Management"}),e.jsx("p",{className:"text-gray-600",children:"Create and manage custom roles with specific permissions"})]}),e.jsxs("div",{className:"flex gap-3 mt-4 sm:mt-0",children:[e.jsxs("button",{onClick:()=>d(!0),className:"btn btn-primary",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Create Role"]}),e.jsxs("button",{onClick:()=>l(!0),className:"btn btn-secondary",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Assign Role"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search roles...",value:c,onChange:s=>i(s.target.value),className:"input"})})})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:u?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Loading roles..."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Permissions"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Users"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:F.map(s=>{var r,x;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg mr-3",children:e.jsx(Q,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s.name,s.isSystem&&e.jsx("span",{className:"ml-2 px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded-full",children:"System"})]}),s.description&&e.jsx("div",{className:"text-sm text-gray-500",children:s.description})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx($,{className:"w-4 h-4 text-gray-400 mr-2"}),e.jsxs("span",{className:"text-sm text-gray-900",children:[((r=s.permissions)==null?void 0:r.length)||0," permissions"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"w-4 h-4 text-gray-400 mr-2"}),e.jsxs("span",{className:"text-sm text-gray-900",children:[((x=s._count)==null?void 0:x.users)||0," users"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.isActive?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>p(s),className:"text-blue-600 hover:text-blue-900",disabled:s.isSystem,children:e.jsx(I,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{b(s),l(!0)},className:"text-green-600 hover:text-green-900",children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>D(s.id),className:"text-red-600 hover:text-red-900",disabled:s.isSystem,children:e.jsx(O,{className:"w-4 h-4"})})]})})]},s.id)})})]})})}),a&&e.jsx(B,{permissions:(m==null?void 0:m.data)||[],onClose:()=>d(!1),onSubmit:P,isLoading:C.isLoading}),h&&e.jsx(G,{role:h,permissions:(m==null?void 0:m.data)||[],onClose:()=>p(null),onSubmit:q,isLoading:S.isLoading}),o&&e.jsx(H,{role:j,employees:((A=w==null?void 0:w.data)==null?void 0:A.employees)||[],onClose:()=>{l(!1),b(null)},onSubmit:z,isLoading:k.isLoading})]})},B=({permissions:a,onClose:d,onSubmit:h,isLoading:p})=>{const[o,l]=N.useState({name:"",description:"",permissions:[]}),j=i=>{i.preventDefault(),h(o)},b=i=>{l(n=>({...n,permissions:n.permissions.includes(i)?n.permissions.filter(t=>t!==i):[...n.permissions,i]}))},c=a.reduce((i,n)=>(i[n.category]||(i[n.category]=[]),i[n.category].push(n),i),{});return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Create Role"}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Role Name"}),e.jsx("input",{type:"text",value:o.name,onChange:i=>l({...o,name:i.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("textarea",{value:o.description,onChange:i=>l({...o,description:i.target.value}),className:"input",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Permissions"}),e.jsx("div",{className:"max-h-64 overflow-y-auto border rounded-lg p-4",children:Object.entries(c).map(([i,n])=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2 capitalize",children:i}),e.jsx("div",{className:"space-y-2",children:n.map(t=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.permissions.includes(t.id),onChange:()=>b(t.id),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:t.description||t.name})]},t.id))})]},i))})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:d,className:"btn btn-outline",disabled:p,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:p,children:p?"Creating...":"Create Role"})]})]})]})})},G=({role:a,permissions:d,onClose:h,onSubmit:p,isLoading:o})=>{var n;const[l,j]=N.useState({name:a.name,description:a.description||"",isActive:a.isActive,permissions:((n=a.permissions)==null?void 0:n.map(t=>t.permissionId))||[]}),b=t=>{t.preventDefault(),p(l)},c=t=>{j(u=>({...u,permissions:u.permissions.includes(t)?u.permissions.filter(m=>m!==t):[...u.permissions,t]}))},i=d.reduce((t,u)=>(t[u.category]||(t[u.category]=[]),t[u.category].push(u),t),{});return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Edit Role"}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Role Name"}),e.jsx("input",{type:"text",value:l.name,onChange:t=>j({...l,name:t.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("textarea",{value:l.description,onChange:t=>j({...l,description:t.target.value}),className:"input",rows:3})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.isActive,onChange:t=>j({...l,isActive:t.target.checked}),className:"mr-2"}),"Active"]})}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Permissions"}),e.jsx("div",{className:"max-h-64 overflow-y-auto border rounded-lg p-4",children:Object.entries(i).map(([t,u])=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2 capitalize",children:t}),e.jsx("div",{className:"space-y-2",children:u.map(m=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.permissions.includes(m.id),onChange:()=>c(m.id),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:m.description||m.name})]},m.id))})]},t))})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:h,className:"btn btn-outline",disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?"Updating...":"Update Role"})]})]})]})})},H=({role:a,employees:d,onClose:h,onSubmit:p,isLoading:o})=>{const[l,j]=N.useState({userId:"",roleId:(a==null?void 0:a.id)||""}),b=c=>{c.preventDefault(),p(l)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Assign Role"}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Role"}),e.jsx("input",{type:"text",value:(a==null?void 0:a.name)||"",className:"input",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Employee"}),e.jsxs("select",{value:l.userId,onChange:c=>j({...l,userId:c.target.value}),className:"input",required:!0,children:[e.jsx("option",{value:"",children:"Select Employee"}),d.map(c=>e.jsxs("option",{value:c.user.id,children:[c.user.firstName," ",c.user.lastName," (",c.user.email,")"]},c.id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:h,className:"btn btn-outline",disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?"Assigning...":"Assign Role"})]})]})]})})};export{se as default};
//# sourceMappingURL=RoleManagement-BqLz83gc.js.map
