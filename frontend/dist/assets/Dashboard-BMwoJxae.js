var ye=Object.defineProperty;var ve=(t,a,h)=>a in t?ye(t,a,{enumerable:!0,configurable:!0,writable:!0,value:h}):t[a]=h;var L=(t,a,h)=>ve(t,typeof a!="symbol"?a+"":a,h);import{j as e,c as je,u as ke,a as Ne}from"./index-BpZZjWg7.js";import{r as i,u as we}from"./router-BXhMSvr3.js";import{u as Ce,a as N,b as ie}from"./query-DSXC375t.js";import{a as A}from"./attendanceService-D6T6fg54.js";import{l as ce}from"./leaveService-VV-NM-ee.js";import{e as Ie}from"./employeeService-C8OM96IH.js";import{b as Le,c as Ae,W as Re,X as me,R as Se,d as E,z as n,C as S,M as Ee}from"./ui-BANi3Jhe.js";import{g as ue,a as Me,c as Oe}from"./camera-uGge9r08.js";import{l as de}from"./locationTrackingService-B2S1ibnQ.js";import"./vendor-C8w-UNLI.js";import"./utils-ngrFHoWO.js";class Te{constructor(a=3e4){L(this,"intervalId",null);L(this,"attendanceId",null);L(this,"isTracking",!1);L(this,"trackingInterval",3e4);this.trackingInterval=a}async startTracking(a){if(this.isTracking){console.log("Location tracking already active");return}this.attendanceId=a,this.isTracking=!0,console.log("🚀 Starting location tracking for attendance:",a),await this.trackCurrentLocation(),this.intervalId=setInterval(async()=>{this.isTracking&&this.attendanceId&&await this.trackCurrentLocation()},this.trackingInterval)}async stopTracking(){if(!this.isTracking||!this.attendanceId){console.log("No active tracking to stop");return}console.log("🛑 Stopping location tracking for attendance:",this.attendanceId),this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null);try{await de.stopTracking(this.attendanceId),console.log("✅ Location tracking stopped successfully")}catch(a){console.error("❌ Error stopping location tracking:",a)}this.isTracking=!1,this.attendanceId=null}async trackCurrentLocation(){if(this.attendanceId)try{const a=await ue(),h={attendanceId:this.attendanceId,latitude:a.latitude,longitude:a.longitude,accuracy:a.accuracy,address:a.address};await de.trackLocation(h),console.log("📍 Location tracked:",{lat:a.latitude,lng:a.longitude,address:a.address,timestamp:new Date().toISOString()})}catch(a){console.error("❌ Error tracking location:",a)}}getStatus(){return{isTracking:this.isTracking,attendanceId:this.attendanceId}}setInterval(a){this.trackingInterval=a,this.isTracking&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=setInterval(async()=>{this.isTracking&&this.attendanceId&&await this.trackCurrentLocation()},this.trackingInterval))}}const he=new Te,Pe=()=>{const[t,a]=i.useState(null),[h,b]=i.useState(!1),[o,u]=i.useState(null),[l,g]=i.useState(null),p=async()=>{b(!0),g(null);try{const f=await je();a(f.isHealthy),u(new Date),f.isHealthy||g(f.error)}catch(f){a(!1),g(f.message),u(new Date)}finally{b(!1)}};return i.useEffect(()=>{p()},[]),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Backend Connection"}),e.jsx("button",{onClick:p,disabled:h,className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200 disabled:opacity-50",children:h?"Testing...":"Test Again"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[t===null?e.jsx(Le,{className:"w-5 h-5 text-gray-400"}):t?e.jsx(Ae,{className:"w-5 h-5 text-green-500"}):e.jsx(Re,{className:"w-5 h-5 text-red-500"}),e.jsxs("div",{className:"flex-1",children:[t===null&&e.jsx("p",{className:"text-gray-600",children:"Testing connection..."}),t===!0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 font-medium",children:"✅ Backend is running"}),o&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Last checked: ",o.toLocaleTimeString()]})]}),t===!1&&e.jsxs("div",{children:[e.jsx("p",{className:"text-red-600 font-medium",children:"❌ Cannot connect to backend"}),l&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l}),o&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Last checked: ",o.toLocaleTimeString()]})]})]})]}),t===!1&&e.jsxs("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800 mb-2",children:"Troubleshooting:"}),e.jsxs("ul",{className:"text-xs text-red-700 space-y-1",children:[e.jsx("li",{children:"• Check if the backend server is running"}),e.jsx("li",{children:"• Verify your internet connection"}),e.jsx("li",{children:"• Try refreshing the page"}),e.jsx("li",{children:"• Contact support if the issue persists"})]})]})]})},De=({isOpen:t,onClose:a,onCapture:h,title:b})=>{const o=i.useRef(null),u=i.useRef(null),l=i.useRef(null),[g,p]=i.useState(!1),[f,M]=i.useState("user");i.useEffect(()=>(t?w():y(),()=>{y()}),[t,f]);const w=async()=>{try{const m={video:{facingMode:f,width:{ideal:1280},height:{ideal:720}},audio:!1},c=await navigator.mediaDevices.getUserMedia(m);l.current=c,o.current&&(o.current.srcObject=c,o.current.play(),p(!0))}catch(m){throw console.error("❌ Camera access failed:",m),new Error("Camera access denied or not available")}},y=()=>{l.current&&(l.current.getTracks().forEach(m=>m.stop()),l.current=null),p(!1)},O=()=>{if(!o.current||!u.current)return;const m=o.current,c=u.current,R=c.getContext("2d");if(!R)return;c.width=m.videoWidth,c.height=m.videoHeight,R.drawImage(m,0,0,c.width,c.height);const I=c.toDataURL("image/jpeg",.8);y(),h(I),a()},C=()=>{M(m=>m==="user"?"environment":"user")};return t?e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center",children:e.jsxs("div",{className:"relative w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-white text-lg font-semibold",children:b}),e.jsx("button",{onClick:a,className:"text-white hover:text-gray-300 transition-colors",children:e.jsx(me,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden",children:[e.jsx("video",{ref:o,className:"w-full h-64 object-cover",playsInline:!0,muted:!0}),e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("button",{onClick:C,className:"bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-70 transition-all",title:"Switch Camera",children:e.jsx(Se,{className:"w-5 h-5"})})}),e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2",children:e.jsx("button",{onClick:O,disabled:!g,className:"bg-white w-16 h-16 rounded-full flex items-center justify-center shadow-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:e.jsx(E,{className:"w-8 h-8 text-gray-800"})})})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-white text-sm",children:g?"Position yourself in the frame and tap the camera button":"Starting camera..."})}),e.jsx("canvas",{ref:u,className:"hidden"})]})}):null},Ke=()=>{var _,U,W,H,B,Q,$,G,V,z,K,Y,X,J,Z,ee,te,se,re,ae,le,oe,ne;const{user:t}=ke(),a=we();console.log("👤 Dashboard user data:",t),console.log("🔑 User role:",t==null?void 0:t.role),console.log("🆔 User ID:",t==null?void 0:t.id);const[h,b]=i.useState(!1),[o,u]=i.useState(null),[l,g]=i.useState(null),[p,f]=i.useState(!1),[M,w]=i.useState(!1),y=Ce(),O=()=>{var r,d;return(r=s==null?void 0:s.status)!=null&&r.isCompleted?{type:"completed",message:"🎉 Work day completed successfully!",color:"green",icon:"✅"}:(d=s==null?void 0:s.status)!=null&&d.canCheckOut?{type:"checkout",message:"🌆 Ready for smart check-out",color:"orange",icon:"🕐"}:{type:"checkin",message:"🌅 Ready for smart check-in",color:"blue",icon:"🚀"}},{data:C,error:m}=N("my-attendance",()=>A.getAttendance({employeeId:t==null?void 0:t.employeeId}),{enabled:!!(t!=null&&t.employeeId),retry:2,retryDelay:1e3,onError:r=>{r.code!=="NETWORK_ERROR"&&console.error("Attendance data fetch error:",r)}}),{data:c,error:R}=N("my-leave-requests",()=>ce.getLeaveRequests({employeeId:t==null?void 0:t.employeeId}),{enabled:!!(t!=null&&t.employeeId),retry:2,retryDelay:1e3,onError:r=>{r.code!=="NETWORK_ERROR"&&console.error("Leave data fetch error:",r)}}),{data:I,error:ge}=N("employee-stats",()=>Ie.getEmployeeStats(),{enabled:(t==null?void 0:t.role)==="SUPER_ADMIN"||(t==null?void 0:t.role)==="HR_MANAGER",retry:2,retryDelay:1e3,onError:r=>{r.code!=="NETWORK_ERROR"&&console.error("Employee stats fetch error:",r)}}),{data:T,error:xe}=N("attendance-stats",()=>A.getAttendanceStats(),{enabled:(t==null?void 0:t.role)==="SUPER_ADMIN"||(t==null?void 0:t.role)==="HR_MANAGER",retry:2,retryDelay:1e3,onError:r=>{r.code!=="NETWORK_ERROR"&&console.error("Attendance stats fetch error:",r)}}),{data:P,error:be}=N("leave-stats",()=>ce.getLeaveStats(),{enabled:(t==null?void 0:t.role)==="SUPER_ADMIN"||(t==null?void 0:t.role)==="HR_MANAGER",retry:2,retryDelay:1e3,onError:r=>{r.code!=="NETWORK_ERROR"&&console.error("Leave stats fetch error:",r)}}),j=ie(A.selfCheckIn,{onSuccess:r=>{y.invalidateQueries("my-attendance"),y.invalidateQueries("attendance-status"),r!=null&&r.id&&(he.startTracking(r.id),console.log("🚀 Location tracking started for attendance:",r.id)),n.success("✅ Check-in completed successfully! Location tracking started."),b(!1),u(null),g(null)},onError:r=>{var v,x;const d=((x=(v=r.response)==null?void 0:v.data)==null?void 0:x.error)||"Failed to check in";d.includes("already marked")?n.error("You have already checked in today. Please check out first."):d.includes("Already completed attendance")?n.error("Attendance already completed for today"):n.error(d)}}),k=ie(A.selfCheckOut,{onSuccess:()=>{y.invalidateQueries("my-attendance"),y.invalidateQueries("attendance-status"),he.stopTracking(),console.log("🛑 Location tracking stopped after check-out"),n.success("✅ Check-out completed successfully! Your attendance has been recorded with selfie and location."),b(!1),u(null),g(null)},onError:r=>{var v,x;const d=((x=(v=r.response)==null?void 0:v.data)==null?void 0:x.error)||"Failed to check out";d.includes("No active check-in")?n.error("❌ Please check in first before checking out"):d.includes("Already checked out")?n.error("❌ You have already checked out today"):d.includes("User ID required")?n.error("❌ Authentication error. Please login again."):n.error(`❌ Check-out failed: ${d}`)}});i.useEffect(()=>{if(l&&o&&!j.isLoading&&!k.isLoading){console.log("🧠 Smart system: Both selfie and location ready, auto-submitting...");const r=l.length>1e5?1e3:500,d=setTimeout(()=>{F()},r);return()=>clearTimeout(d)}},[l,o,j.isLoading,k.isLoading]);const{data:s}=N("attendance-status",()=>A.getAttendanceStatus(),{enabled:!!(t!=null&&t.employeeId),refetchInterval:3e4,refetchOnWindowFocus:!0,onSuccess:r=>{console.log("📊 Frontend attendance status:",r)}}),D=async()=>{await pe()},pe=async()=>{try{const r=await ue();u(r),console.log("📍 Location captured automatically:",{hasLocation:!!r,locationData:r}),n.success("📍 Location captured automatically!")}catch(r){console.log("❌ Location capture failed:",r),n.error(r.message||"Failed to get location");return}w(!0)},fe=r=>{g(r),console.log("📸 Selfie captured from live camera:",{hasSelfie:!!r,selfieLength:(r==null?void 0:r.length)||0}),n.success("📸 Selfie captured successfully!"),w(!1),o?n("✅ Both selfie and location ready! Attendance will be marked automatically.",{icon:"ℹ️"}):n("📍 Selfie captured! Waiting for location data...",{icon:"ℹ️"})},F=()=>{var v;const r=Me();console.log("🔍 Auto-submit state check:",{hasSelfie:!!l,selfieLength:(l==null?void 0:l.length)||0,hasLocation:!!o,locationData:o,attendanceStatus:s==null?void 0:s.status,user:t,userId:t==null?void 0:t.id,isAuthenticated:Ne.isAuthenticated()});const d=(v=s==null?void 0:s.status)==null?void 0:v.canCheckOut;if(d){if(!l){n.error("❌ Check-out requires a selfie. Please capture your selfie first.");return}if(!o){n.error("❌ Check-out requires location. Please allow location access.");return}console.log("✅ Check-out requirements validated: Selfie + Location captured")}else{if(!l){n.error("❌ Check-in requires a selfie. Please capture your selfie first.");return}if(!o){n.error("❌ Check-in requires location. Please allow location access.");return}console.log("✅ Check-in requirements validated: Selfie + Location captured")}if(d){const x={notes:void 0,checkOutSelfie:l||void 0,checkOutLocation:o||void 0};console.log("🔍 Check-out data being sent:",{hasSelfie:!!l,selfieLength:(l==null?void 0:l.length)||0,selfiePreview:(l==null?void 0:l.substring(0,50))+"...",hasLocation:!!o,locationData:o,checkOutData:x,fullPayload:{notes:void 0,checkOutSelfie:l||void 0,checkOutLocation:o||void 0}}),n.loading("🎯 Automatically checking out...",{duration:2e3}),k.mutate(x)}else{const x={isRemote:!1,notes:void 0,checkInSelfie:l||void 0,checkInLocation:o||void 0,deviceInfo:r||void 0,shiftId:null};console.log("🔍 Check-in data being sent:",{hasSelfie:!!l,selfieLength:(l==null?void 0:l.length)||0,selfiePreview:(l==null?void 0:l.substring(0,50))+"...",hasLocation:!!o,locationData:o,checkInData:x,fullPayload:{isRemote:!1,notes:void 0,checkInSelfie:l||void 0,checkInLocation:o||void 0,deviceInfo:r||void 0,shiftId:null}}),n.loading("🎯 Automatically checking in...",{duration:2e3}),j.mutate(x)}},q=(t==null?void 0:t.role)==="SUPER_ADMIN"||(t==null?void 0:t.role)==="HR_MANAGER";return e.jsxs("div",{className:"p-6",children:[e.jsx(Pe,{}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"🎉 Dashboard Loaded Successfully!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Welcome to the Employee Attendance System Dashboard"}),q?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:(I==null?void 0:I.totalEmployees)||0})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-900",children:"Active Today"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:(T==null?void 0:T.presentCount)||0})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-purple-900",children:"Pending Leaves"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:(P==null?void 0:P.pendingRequests)||0})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"My Attendance"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:((U=(_=C==null?void 0:C.data)==null?void 0:_.attendances)==null?void 0:U.length)||0})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-900",children:"My Leave Requests"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:((H=(W=c==null?void 0:c.data)==null?void 0:W.leaveRequests)==null?void 0:H.length)||0})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-purple-900",children:"Pending Leaves"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:((Q=(B=c==null?void 0:c.data)==null?void 0:B.leaveRequests)==null?void 0:Q.filter(r=>r.status==="PENDING").length)||0})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsx("div",{className:"space-y-2",children:q?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a("/attendance"),className:"w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors cursor-pointer",children:"Mark Attendance"}),e.jsx("button",{onClick:()=>a("/employees"),className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded hover:bg-gray-300 transition-colors cursor-pointer",children:"View Employees"}),e.jsx("button",{onClick:()=>a("/leave-requests"),className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded hover:bg-gray-300 transition-colors cursor-pointer",children:"Manage Leave Requests"}),(t==null?void 0:t.role)==="SUPER_ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a("/employees"),className:"w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700 transition-colors cursor-pointer",children:"User & Role Management"}),e.jsx("button",{onClick:()=>a("/shifts"),className:"w-full bg-orange-600 text-white py-2 px-4 rounded hover:bg-orange-700 transition-colors cursor-pointer",children:"Shift Management"}),e.jsx("button",{onClick:()=>a("/settings"),className:"w-full bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 transition-colors cursor-pointer",children:"System Settings"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>b(!0),className:"w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition-colors cursor-pointer",children:"Mark Self Attendance"}),e.jsx("button",{onClick:()=>a("/my-attendance"),className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded hover:bg-gray-300 transition-colors cursor-pointer",children:"View My Attendance"}),e.jsx("button",{onClick:()=>a("/my-leave"),className:"w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors cursor-pointer",children:"Request Leave"}),e.jsx("button",{onClick:()=>a("/profile"),className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded hover:bg-gray-300 transition-colors cursor-pointer",children:"View My Profile"})]})})]}),(t==null?void 0:t.role)==="SUPER_ADMIN"&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Super Admin Features"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"font-semibold text-purple-900 mb-2",children:"User Management"}),e.jsx("p",{className:"text-sm text-purple-700 mb-3",children:"Manage employees and users"}),e.jsx("button",{onClick:()=>a("/employees"),className:"w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700 text-sm transition-colors cursor-pointer",children:"Manage Employees"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[e.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:"Shift Management"}),e.jsx("p",{className:"text-sm text-orange-700 mb-3",children:"Create and manage work shifts"}),e.jsx("button",{onClick:()=>a("/shifts"),className:"w-full bg-orange-600 text-white py-2 px-4 rounded hover:bg-orange-700 text-sm transition-colors cursor-pointer",children:"Manage Shifts"})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"System Settings"}),e.jsx("p",{className:"text-sm text-red-700 mb-3",children:"Configure system-wide settings"}),e.jsx("button",{onClick:()=>a("/settings"),className:"w-full bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 text-sm transition-colors cursor-pointer",children:"System Config"})]}),e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg border border-indigo-200",children:[e.jsx("h3",{className:"font-semibold text-indigo-900 mb-2",children:"Payroll Management"}),e.jsx("p",{className:"text-sm text-indigo-700 mb-3",children:"Manage employee salaries"}),e.jsx("button",{onClick:()=>a("/payroll"),className:"w-full bg-indigo-600 text-white py-2 px-4 rounded hover:bg-indigo-700 text-sm transition-colors cursor-pointer",children:"Manage Payroll"})]}),e.jsxs("div",{className:"bg-teal-50 p-4 rounded-lg border border-teal-200",children:[e.jsx("h3",{className:"font-semibold text-teal-900 mb-2",children:"Attendance Reports"}),e.jsx("p",{className:"text-sm text-teal-700 mb-3",children:"View attendance analytics"}),e.jsx("button",{onClick:()=>a("/attendance"),className:"w-full bg-teal-600 text-white py-2 px-4 rounded hover:bg-teal-700 text-sm transition-colors cursor-pointer",children:"View Attendance"})]}),e.jsxs("div",{className:"bg-pink-50 p-4 rounded-lg border border-pink-200",children:[e.jsx("h3",{className:"font-semibold text-pink-900 mb-2",children:"Leave Management"}),e.jsx("p",{className:"text-sm text-pink-700 mb-3",children:"Manage leave requests"}),e.jsx("button",{onClick:()=>a("/leave"),className:"w-full bg-pink-600 text-white py-2 px-4 rounded hover:bg-pink-700 text-sm transition-colors cursor-pointer",children:"Manage Leaves"})]})]})]}),e.jsxs("div",{className:"mt-8 p-4 bg-green-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-900",children:"System Status"}),e.jsx("p",{className:"text-green-700",children:"✅ All systems operational"}),(m||R||ge||xe||be)&&e.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded",children:e.jsx("p",{className:"text-yellow-800 text-sm",children:"⚠️ Some data may not be up to date due to network issues. Please refresh the page."})})]})]}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-lg mx-auto max-h-[95vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b sticky top-0 bg-white z-10",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(S,{className:"w-5 h-5 mr-2"}),"Mark Attendance"]}),e.jsx("button",{onClick:()=>{b(!1),g(null),u(null)},className:"text-gray-400 hover:text-gray-600",children:e.jsx(me,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[(()=>{const r=O();return e.jsxs("div",{className:`mb-6 p-4 rounded-lg border-2 ${r.color==="green"?"bg-green-50 border-green-200":r.color==="orange"?"bg-orange-50 border-orange-200":"bg-blue-50 border-blue-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${r.color==="green"?"bg-green-500":r.color==="orange"?"bg-orange-500":"bg-blue-500"}`}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[r.icon," ",r.message]})]}),r.type!=="completed"&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx("p",{className:"text-xs text-gray-600",children:"🧠 Smart system will handle location + selfie automatically"})})]})})(),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(S,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Automatic Data Capture"})]}),e.jsx("p",{className:"text-sm text-blue-700",children:"Date, time, and status will be automatically captured when you take your selfie."})]}),!l&&!o?e.jsxs("div",{className:"p-8 bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 border-2 border-blue-400 rounded-xl shadow-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:`w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg ${($=s==null?void 0:s.status)!=null&&$.canCheckOut?"bg-orange-600":(G=s==null?void 0:s.status)!=null&&G.isCompleted?"bg-green-600":"bg-blue-600"}`,children:e.jsx(E,{className:"w-10 h-10 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:(V=s==null?void 0:s.status)!=null&&V.isCompleted?"✅ Attendance Completed":(z=s==null?void 0:s.status)!=null&&z.canCheckOut?"📸 Check-Out Selfie":"📸 Check-In Selfie"}),e.jsx("p",{className:"text-base text-gray-700",children:(K=s==null?void 0:s.status)!=null&&K.isCompleted?"🎉 You have completed your attendance for today":(Y=s==null?void 0:s.status)!=null&&Y.canCheckOut?"🌆 Take your check-out selfie":"🌅 Take your check-in selfie"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:(X=s==null?void 0:s.status)!=null&&X.isCompleted?"Great job! See you tomorrow.":(J=s==null?void 0:s.status)!=null&&J.canCheckOut?"🌆 One-click smart checkout with selfie & location":"🌅 One-click smart check-in with selfie & location"})]}),e.jsx("button",{type:"button",onClick:D,disabled:p||((Z=s==null?void 0:s.status)==null?void 0:Z.isCompleted),className:`w-full flex items-center justify-center gap-3 px-8 py-4 text-white text-xl font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed shadow-xl transform transition-all duration-300 hover:scale-105 hover:shadow-2xl ${(ee=s==null?void 0:s.status)!=null&&ee.isCompleted?"bg-gray-500 cursor-not-allowed":(te=s==null?void 0:s.status)!=null&&te.canCheckOut?"bg-gradient-to-r from-orange-500 via-orange-600 to-orange-700 hover:from-orange-600 hover:via-orange-700 hover:to-orange-800":"bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:from-blue-600 hover:via-blue-700 hover:to-blue-800"}`,children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"}),"Opening Camera..."]}):(se=s==null?void 0:s.status)!=null&&se.isCompleted?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-6 h-6",children:"✅"}),"Attendance Completed"]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-6 h-6"}),"📸 ",(re=s==null?void 0:s.status)!=null&&re.canCheckOut?"Smart Check-Out":"Smart Check-In"]})}),e.jsxs("p",{className:"text-xs text-gray-600 mt-4 text-center bg-white/50 p-3 rounded-lg",children:["ℹ️ ",(ae=s==null?void 0:s.status)!=null&&ae.canCheckOut?"Smart Check-Out: Automatic location + live camera selfie":"Smart Check-In: Automatic location + live camera selfie"]})]}):e.jsxs(e.Fragment,{children:[l&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-lg font-semibold",children:"📸 Attendance Selfie ✅"}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:l,alt:"Attendance Selfie",className:"w-full h-80 object-cover rounded-xl border-4 border-green-500 shadow-lg"}),e.jsxs("button",{type:"button",onClick:()=>{g(null),u(null)},className:"absolute top-3 right-3 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 flex items-center gap-2 shadow-lg",children:[e.jsx(E,{className:"w-5 h-5"}),"Retake"]})]}),l&&o&&e.jsx("div",{className:"mt-4 p-4 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-lg shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("p",{className:"text-green-800 font-medium",children:"🧠 Smart system ready! Both selfie and location captured"}),e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("button",{type:"button",onClick:F,disabled:j.isLoading||k.isLoading,className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-lg font-bold text-lg hover:from-green-600 hover:to-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 shadow-lg transform transition-all duration-300 hover:scale-105",children:j.isLoading||k.isLoading?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"}),(le=s==null?void 0:s.status)!=null&&le.canCheckOut?"Checking Out...":"Checking In..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-6 h-6"}),(oe=s==null?void 0:s.status)!=null&&oe.canCheckOut?"Complete Check-Out":"Complete Check-In"]})})]})})]}),o&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Your Location ✅"}),e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-green-600"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium text-green-900",children:o.address||`${o.latitude.toFixed(6)}, ${o.longitude.toFixed(6)}`})})]})})]})]}),l&&o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-800",children:"Time will be automatically captured"})]}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"Current time will be used for check-in/check-out"})]}),e.jsx("div",{className:"p-2 bg-blue-50 border border-blue-200 rounded text-center",children:e.jsx("p",{className:"text-xs text-blue-700",children:"✅ Selfie, Location, Device & IP captured"})})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{type:"button",onClick:async()=>{try{const r=await Oe();r.hasPermission?n.success("✅ Camera is working perfectly!"):n.error(r.message)}catch(r){n.error("Camera test failed: "+r.message)}},className:"bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors mr-2",children:"Test Camera"}),e.jsx("button",{type:"button",onClick:D,disabled:p||j.isLoading||k.isLoading,className:"flex-1 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 disabled:opacity-50",children:p?"Capturing...":j.isLoading?"Checking In...":k.isLoading?"Checking Out...":"Take Selfie & Mark Attendance"})]})]})]})}),e.jsx(De,{isOpen:M,onClose:()=>w(!1),onCapture:fe,title:(ne=s==null?void 0:s.status)!=null&&ne.canCheckOut?"Check-Out Selfie":"Check-In Selfie"})]})};export{Ke as default};
//# sourceMappingURL=Dashboard-BMwoJxae.js.map
