import{j as e}from"./index-BpZZjWg7.js";import{r}from"./router-BXhMSvr3.js";import{u as J,a as F,b as K}from"./query-DSXC375t.js";import{a as Y}from"./attendanceService-D6T6fg54.js";import{e as Z}from"./employeeService-C8OM96IH.js";import{a as ee,k as te,g as _,C as H,H as se,b as ae,c as ne,z as c}from"./ui-BANi3Jhe.js";import{a as le,b as re,d as ce,g as ie}from"./camera-uGge9r08.js";import"./vendor-C8w-UNLI.js";import"./utils-ngrFHoWO.js";const je=()=>{var y,w,S,k,C,E,A,L,I,D,T,R;const[l,m]=r.useState(new Date),[i,g]=r.useState(""),[P,u]=r.useState(!1),[a,d]=r.useState({checkIn:"",checkOut:"",status:"PRESENT",notes:"",isRemote:!1}),[b,p]=r.useState(null),[j,N]=r.useState(null),[v,f]=r.useState(!1),B=J(),{data:n}=F("employees",()=>Z.getEmployees({page:1,limit:1e3})),{data:h,isLoading:Q}=F(["attendance-calendar",l.toISOString().split("T")[0]],()=>Y.getAttendance({startDate:l.toISOString().split("T")[0],endDate:l.toISOString().split("T")[0]})),x=K(Y.markAttendance,{onSuccess:()=>{B.invalidateQueries("attendance-calendar"),c.success("Attendance marked successfully!"),u(!1),p(null),N(null)},onError:t=>{var s,o;c.error(((o=(s=t.response)==null?void 0:s.data)==null?void 0:o.error)||"Failed to mark attendance")}}),z=t=>{m(t)},V=t=>{g(t),u(!0)},q=async()=>{f(!0);try{const t=await re(),s=await ce(t);p(s),c.success("ðŸ“¸ Selfie captured successfully!")}catch(t){c.error(t.message||"Failed to capture selfie")}finally{f(!1)}},U=async()=>{try{const t=await ie();N(t),c.success("ðŸ“ Location captured successfully!")}catch(t){c.error(t.message||"Failed to get location")}},W=async t=>{if(t.preventDefault(),!i){c.error("Please select an employee");return}const s={employeeId:i,date:l.toISOString().split("T")[0],checkIn:a.checkIn||void 0,checkOut:a.checkOut||void 0,status:a.status,notes:a.notes||void 0,isRemote:a.isRemote,checkInSelfie:b||void 0,checkInLocation:j||void 0,deviceInfo:le()||void 0};x.mutate(s)},X=t=>{var o,O;return(O=(o=h==null?void 0:h.data)==null?void 0:o.attendances)==null?void 0:O.find(M=>M.employeeId===t&&new Date(M.date).toDateString()===l.toDateString())},$=t=>{switch(t){case"PRESENT":return"bg-green-100 text-green-800 border-green-200";case"LATE":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"ABSENT":return"bg-red-100 text-red-800 border-red-200";case"HALF_DAY":return"bg-blue-100 text-blue-800 border-blue-200";case"EARLY_LEAVE":return"bg-orange-100 text-orange-800 border-orange-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},G=t=>{switch(t){case"PRESENT":return e.jsx(ne,{className:"w-4 h-4"});case"LATE":return e.jsx(H,{className:"w-4 h-4"});case"ABSENT":return e.jsx(_,{className:"w-4 h-4"});case"HALF_DAY":return e.jsx(ae,{className:"w-4 h-4"});case"EARLY_LEAVE":return e.jsx(se,{className:"w-4 h-4"});default:return e.jsx(H,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Attendance Calendar"}),e.jsx("p",{className:"text-gray-600",children:"Mark attendance for any employee on any date"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"text-sm text-gray-600",children:["Selected: ",l.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Select Date"]}),e.jsx("input",{type:"date",value:l.toISOString().split("T")[0],onChange:t=>z(new Date(t.target.value)),className:"w-full input"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"Select Employee"]}),e.jsxs("select",{value:i,onChange:t=>g(t.target.value),className:"w-full input",children:[e.jsx("option",{value:"",children:"Choose an employee..."}),(w=(y=n==null?void 0:n.data)==null?void 0:y.employees)==null?void 0:w.map(t=>e.jsxs("option",{value:t.id,children:[t.user.firstName," ",t.user.lastName," - ",t.employeeId]},t.id))]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>m(new Date),className:"w-full btn btn-outline btn-sm",children:"Today"}),e.jsx("button",{onClick:()=>m(new Date(Date.now()-1440*60*1e3)),className:"w-full btn btn-outline btn-sm",children:"Yesterday"}),e.jsx("button",{onClick:()=>m(new Date(Date.now()+1440*60*1e3)),className:"w-full btn btn-outline btn-sm",children:"Tomorrow"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Employee Attendance Status - ",l.toLocaleDateString()]})}),e.jsx("div",{className:"p-6",children:Q?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Loading attendance data..."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(k=(S=n==null?void 0:n.data)==null?void 0:S.employees)==null?void 0:k.map(t=>{const s=X(t.id);return e.jsxs("div",{className:`p-4 rounded-lg border-2 cursor-pointer transition-all hover:shadow-md ${s?$(s.status):"bg-gray-50 border-gray-200 hover:border-gray-300"}`,onClick:()=>V(t.id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900",children:[t.user.firstName," ",t.user.lastName]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.employeeId}),e.jsx("p",{className:"text-xs text-gray-500",children:t.department})]}),e.jsx("div",{className:"flex items-center gap-2",children:s?e.jsxs(e.Fragment,{children:[G(s.status),e.jsx("span",{className:"text-sm font-medium",children:s.status.replace("_"," ")})]}):e.jsxs("div",{className:"text-gray-400",children:[e.jsx(_,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Not Marked"})]})})]}),s&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[s.checkIn&&e.jsxs("div",{children:["In: ",new Date(s.checkIn).toLocaleTimeString()]}),s.checkOut&&e.jsxs("div",{children:["Out: ",new Date(s.checkOut).toLocaleTimeString()]})]})]},t.id)})})})]}),P&&i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Mark Attendance"}),e.jsxs("p",{className:"text-gray-600",children:[(L=(A=(E=(C=n==null?void 0:n.data)==null?void 0:C.employees)==null?void 0:E.find(t=>t.id===i))==null?void 0:A.user)==null?void 0:L.firstName," "," ",(R=(T=(D=(I=n==null?void 0:n.data)==null?void 0:I.employees)==null?void 0:D.find(t=>t.id===i))==null?void 0:T.user)==null?void 0:R.lastName," - "," ",l.toLocaleDateString()]})]}),e.jsx("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:"âœ•"})]}),e.jsxs("form",{onSubmit:W,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Check-in Time"}),e.jsx("input",{type:"datetime-local",className:"input",value:a.checkIn,onChange:t=>d({...a,checkIn:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Check-out Time"}),e.jsx("input",{type:"datetime-local",className:"input",value:a.checkOut,onChange:t=>d({...a,checkOut:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Status"}),e.jsxs("select",{className:"input",value:a.status,onChange:t=>d({...a,status:t.target.value}),required:!0,children:[e.jsx("option",{value:"PRESENT",children:"Present"}),e.jsx("option",{value:"LATE",children:"Late"}),e.jsx("option",{value:"ABSENT",children:"Absent"}),e.jsx("option",{value:"HALF_DAY",children:"Half Day"}),e.jsx("option",{value:"EARLY_LEAVE",children:"Early Leave"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"isRemote",checked:a.isRemote,onChange:t=>d({...a,isRemote:t.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"isRemote",className:"ml-2 text-sm text-gray-700",children:"ðŸ  Remote Work"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes"}),e.jsx("textarea",{className:"input",rows:3,value:a.notes,onChange:t=>d({...a,notes:t.target.value}),placeholder:"Additional notes..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Selfie (Optional)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:q,disabled:v,className:"btn btn-outline btn-sm",children:v?"Capturing...":"ðŸ“¸ Capture Selfie"}),b&&e.jsx("div",{className:"text-green-600 text-sm",children:"âœ“ Captured"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Location (Optional)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:U,className:"btn btn-outline btn-sm",children:"ðŸ“ Capture Location"}),j&&e.jsx("div",{className:"text-green-600 text-sm",children:"âœ“ Captured"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn btn-outline btn-md",disabled:x.isLoading,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-md",disabled:x.isLoading,children:x.isLoading?"Marking...":"Mark Attendance"})]})]})]})})]})};export{je as default};
//# sourceMappingURL=AttendanceCalendar-BWm0rEvZ.js.map
